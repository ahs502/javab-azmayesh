!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";function t(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function n(){}function r(e){var t;return e=(e+"").trim().toLowerCase(),(t=$.exec(e))?(t=parseInt(t[1],16),new l(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1)):(t=D.exec(e))?o(parseInt(t[1],16)):(t=k.exec(e))?new l(t[1],t[2],t[3],1):(t=E.exec(e))?new l(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=T.exec(e))?a(t[1],t[2],t[3],t[4]):(t=H.exec(e))?a(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=j.exec(e))?u(t[1],t[2]/100,t[3]/100,1):(t=z.exec(e))?u(t[1],t[2]/100,t[3]/100,t[4]):V.hasOwnProperty(e)?o(V[e]):"transparent"===e?new l(NaN,NaN,NaN,0):null}function o(e){return new l(e>>16&255,e>>8&255,255&e,1)}function a(e,t,n,r){return r<=0&&(e=t=n=NaN),new l(e,t,n,r)}function i(e){return e instanceof n||(e=r(e)),e?(e=e.rgb(),new l(e.r,e.g,e.b,e.opacity)):new l}function s(e,t,n,r){return 1===arguments.length?i(e):new l(e,t,n,null==r?1:r)}function l(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function u(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new f(e,t,n,r)}function c(e){if(e instanceof f)return new f(e.h,e.s,e.l,e.opacity);if(e instanceof n||(e=r(e)),!e)return new f;if(e instanceof f)return e;e=e.rgb();var t=e.r/255,o=e.g/255,a=e.b/255,i=Math.min(t,o,a),s=Math.max(t,o,a),l=NaN,u=s-i,c=(s+i)/2;return u?(l=t===s?(o-a)/u+6*(o<a):o===s?(a-t)/u+2:(t-o)/u+4,u/=c<.5?s+i:2-s-i,l*=60):u=c>0&&c<1?0:l,new f(l,u,c,e.opacity)}function d(e,t,n,r){return 1===arguments.length?c(e):new f(e,t,n,null==r?1:r)}function f(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function h(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function m(e){if(e instanceof g)return new g(e.l,e.a,e.b,e.opacity);if(e instanceof M){var t=e.h*U;return new g(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}e instanceof l||(e=i(e));var n=w(e.r),r=w(e.g),o=w(e.b),a=v((.4124564*n+.3575761*r+.1804375*o)/F),s=v((.2126729*n+.7151522*r+.072175*o)/R);return new g(116*s-16,500*(a-s),200*(s-v((.0193339*n+.119192*r+.9503041*o)/B)),e.opacity)}function p(e,t,n,r){return 1===arguments.length?m(e):new g(e,t,n,null==r?1:r)}function g(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function v(e){return e>Y?Math.pow(e,1/3):e/Q+q}function y(e){return e>Z?e*e*e:Q*(e-q)}function b(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function w(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function S(e){if(e instanceof M)return new M(e.h,e.c,e.l,e.opacity);e instanceof g||(e=m(e));var t=Math.atan2(e.b,e.a)*O;return new M(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function C(e,t,n,r){return 1===arguments.length?S(e):new M(e,t,n,null==r?1:r)}function M(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function P(e){if(e instanceof _)return new _(e.h,e.s,e.l,e.opacity);e instanceof l||(e=i(e));var t=e.r/255,n=e.g/255,r=e.b/255,o=(ne*r+ee*t-te*n)/(ne+ee-te),a=r-o,s=(K*(n-o)-J*a)/W,u=Math.sqrt(s*s+a*a)/(K*o*(1-o)),c=u?Math.atan2(s,a)*O-120:NaN;return new _(c<0?c+360:c,u,o,e.opacity)}function N(e,t,n,r){return 1===arguments.length?P(e):new _(e,t,n,null==r?1:r)}function _(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}var x=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e},L="\\s*([+-]?\\d+)\\s*",A="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",I="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$=/^#([0-9a-f]{3})$/,D=/^#([0-9a-f]{6})$/,k=new RegExp("^rgb\\("+[L,L,L]+"\\)$"),E=new RegExp("^rgb\\("+[I,I,I]+"\\)$"),T=new RegExp("^rgba\\("+[L,L,L,A]+"\\)$"),H=new RegExp("^rgba\\("+[I,I,I,A]+"\\)$"),j=new RegExp("^hsl\\("+[A,I,I]+"\\)$"),z=new RegExp("^hsla\\("+[A,I,I,A]+"\\)$"),V={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};x(n,r,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),x(l,s,t(n,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new l(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new l(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(1===e?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}})),x(f,d,t(n,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new f(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new f(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,o=2*n-r;return new l(h(e>=240?e-240:e+120,o,r),h(e,o,r),h(e<120?e+240:e-120,o,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var U=Math.PI/180,O=180/Math.PI,F=.95047,R=1,B=1.08883,q=4/29,Z=6/29,Q=3*Z*Z,Y=Z*Z*Z;x(g,p,t(n,{brighter:function(e){return new g(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new g(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return e=R*y(e),t=F*y(t),n=B*y(n),new l(b(3.2404542*t-1.5371385*e-.4985314*n),b(-.969266*t+1.8760108*e+.041556*n),b(.0556434*t-.2040259*e+1.0572252*n),this.opacity)}})),x(M,C,t(n,{brighter:function(e){return new M(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new M(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return m(this).rgb()}}));var G=-.14861,X=1.78277,J=-.29227,W=-.90649,K=1.97294,ee=K*W,te=K*X,ne=X*J-W*G;x(_,N,t(n,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new _(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new _(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*U,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),o=Math.sin(e);return new l(255*(t+n*(G*r+X*o)),255*(t+n*(J*r+W*o)),255*(t+n*(K*r)),this.opacity)}})),e.color=r,e.rgb=s,e.hsl=d,e.lab=p,e.hcl=C,e.cubehelix=N,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";function t(){for(var e,t=0,r=arguments.length,o={};t<r;++t){if(!(e=arguments[t]+"")||e in o)throw new Error("illegal type: "+e);o[e]=[]}return new n(o)}function n(e){this._=e}function r(e,t){return e.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}})}function o(e,t){for(var n,r=0,o=e.length;r<o;++r)if((n=e[r]).name===t)return n.value}function a(e,t,n){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=i,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}var i={value:function(){}};n.prototype=t.prototype={constructor:n,on:function(e,t){var n,i=this._,s=r(e+"",i),l=-1,u=s.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++l<u;)if(n=(e=s[l]).type)i[n]=a(i[n],e.name,t);else if(null==t)for(n in i)i[n]=a(i[n],e.name,null);return this}for(;++l<u;)if((n=(e=s[l]).type)&&(n=o(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new n(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,o=new Array(n),a=0;a<n;++a)o[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=this._[e],a=0,n=r.length;a<n;++a)r[a].value.apply(t,o)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,a=r.length;o<a;++o)r[o].value.apply(t,n)}},e.dispatch=t,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-dispatch"),require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-selection"],t):t(e.d3=e.d3||{},e.d3,e.d3)}(this,function(e,t,n){"use strict";function r(){n.event.stopImmediatePropagation()}function o(e,t){var r=e.document.documentElement,o=n.select(e).on("dragstart.drag",null);t&&(o.on("click.drag",u,!0),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in r?o.on("selectstart.drag",null):(r.style.MozUserSelect=r.__noselect,delete r.__noselect)}function a(e,t,n,r,o,a,i,s,l,u){this.target=e,this.type=t,this.subject=n,this.identifier=r,this.active=o,this.x=a,this.y=i,this.dx=s,this.dy=l,this._=u}function i(){return!n.event.button}function s(){return this.parentNode}function l(e){return null==e?{x:n.event.x,y:n.event.y}:e}var u=function(){n.event.preventDefault(),n.event.stopImmediatePropagation()},c=function(e){var t=e.document.documentElement,r=n.select(e).on("dragstart.drag",u,!0);"onselectstart"in t?r.on("selectstart.drag",u,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")},d=function(e){return function(){return e}};a.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var f=function(){function e(e){e.on("mousedown.drag",f).on("touchstart.drag",p).on("touchmove.drag",g).on("touchend.drag touchcancel.drag",v).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(){if(!C&&M.apply(this,arguments)){var e=y("mouse",P.apply(this,arguments),n.mouse,this,arguments);e&&(n.select(n.event.view).on("mousemove.drag",h,!0).on("mouseup.drag",m,!0),c(n.event.view),r(),S=!1,b=n.event.clientX,w=n.event.clientY,e("start"))}}function h(){if(u(),!S){var e=n.event.clientX-b,t=n.event.clientY-w;S=e*e+t*t>A}_.mouse("drag")}function m(){n.select(n.event.view).on("mousemove.drag mouseup.drag",null),o(n.event.view,S),u(),_.mouse("end")}function p(){if(M.apply(this,arguments)){var e,t,o=n.event.changedTouches,a=P.apply(this,arguments),i=o.length;for(e=0;e<i;++e)(t=y(o[e].identifier,a,n.touch,this,arguments))&&(r(),t("start"))}}function g(){var e,t,r=n.event.changedTouches,o=r.length;for(e=0;e<o;++e)(t=_[r[e].identifier])&&(u(),t("drag"))}function v(){var e,t,o=n.event.changedTouches,a=o.length;for(C&&clearTimeout(C),C=setTimeout(function(){C=null},500),e=0;e<a;++e)(t=_[o[e].identifier])&&(r(),t("end"))}function y(t,r,o,i,s){var l,u,c,d=o(r,t),f=x.copy();if(n.customEvent(new a(e,"beforestart",l,t,L,d[0],d[1],0,0,f),function(){return null!=(n.event.subject=l=N.apply(i,s))&&(u=l.x-d[0]||0,c=l.y-d[1]||0,!0)}))return function h(m){var p,g=d;switch(m){case"start":_[t]=h,p=L++;break;case"end":delete _[t],--L;case"drag":d=o(r,t),p=L}n.customEvent(new a(e,m,l,t,p,d[0]+u,d[1]+c,d[0]-g[0],d[1]-g[1],f),f.apply,f,[m,i,s])}}var b,w,S,C,M=i,P=s,N=l,_={},x=t.dispatch("start","drag","end"),L=0,A=0;return e.filter=function(t){return arguments.length?(M="function"==typeof t?t:d(!!t),e):M},e.container=function(t){return arguments.length?(P="function"==typeof t?t:d(t),e):P},e.subject=function(t){return arguments.length?(N="function"==typeof t?t:d(t),e):N},e.on=function(){var t=x.on.apply(x,arguments);return t===x?e:t},e.clickDistance=function(t){return arguments.length?(A=(t=+t)*t,e):Math.sqrt(A)},e};e.drag=f,e.dragDisable=c,e.dragEnable=o,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";function t(e){return+e}function n(e){return e*e}function r(e){return e*(2-e)}function o(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}function a(e){return e*e*e}function i(e){return--e*e*e+1}function s(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}function l(e){return 1-Math.cos(e*P)}function u(e){return Math.sin(e*P)}function c(e){return(1-Math.cos(M*e))/2}function d(e){return Math.pow(2,10*e-10)}function f(e){return 1-Math.pow(2,-10*e)}function h(e){return((e*=2)<=1?Math.pow(2,10*e-10):2-Math.pow(2,10-10*e))/2}function m(e){return 1-Math.sqrt(1-e*e)}function p(e){return Math.sqrt(1- --e*e)}function g(e){return((e*=2)<=1?1-Math.sqrt(1-e*e):Math.sqrt(1-(e-=2)*e)+1)/2}function v(e){return 1-y(1-e)}function y(e){return(e=+e)<N?E*e*e:e<x?E*(e-=_)*e+L:e<I?E*(e-=A)*e+$:E*(e-=D)*e+k}function b(e){return((e*=2)<=1?1-y(1-e):y(e-1)+1)/2}var w=function e(t){function n(e){return Math.pow(e,t)}return t=+t,n.exponent=e,n}(3),S=function e(t){function n(e){return 1-Math.pow(1-e,t)}return t=+t,n.exponent=e,n}(3),C=function e(t){function n(e){return((e*=2)<=1?Math.pow(e,t):2-Math.pow(2-e,t))/2}return t=+t,n.exponent=e,n}(3),M=Math.PI,P=M/2,N=4/11,_=6/11,x=8/11,L=.75,A=9/11,I=10/11,$=.9375,D=21/22,k=63/64,E=1/N/N,T=function e(t){function n(e){return e*e*((t+1)*e-t)}return t=+t,n.overshoot=e,n}(1.70158),H=function e(t){function n(e){return--e*e*((t+1)*e+t)+1}return t=+t,n.overshoot=e,n}(1.70158),j=function e(t){function n(e){return((e*=2)<1?e*e*((t+1)*e-t):(e-=2)*e*((t+1)*e+t)+2)/2}return t=+t,n.overshoot=e,n}(1.70158),z=2*Math.PI,V=function e(t,n){function r(e){return t*Math.pow(2,10*--e)*Math.sin((o-e)/n)}var o=Math.asin(1/(t=Math.max(1,t)))*(n/=z);return r.amplitude=function(t){return e(t,n*z)},r.period=function(n){return e(t,n)},r}(1,.3),U=function e(t,n){function r(e){return 1-t*Math.pow(2,-10*(e=+e))*Math.sin((e+o)/n)}var o=Math.asin(1/(t=Math.max(1,t)))*(n/=z);return r.amplitude=function(t){return e(t,n*z)},r.period=function(n){return e(t,n)},r}(1,.3),O=function e(t,n){function r(e){return((e=2*e-1)<0?t*Math.pow(2,10*e)*Math.sin((o-e)/n):2-t*Math.pow(2,-10*e)*Math.sin((o+e)/n))/2}var o=Math.asin(1/(t=Math.max(1,t)))*(n/=z);return r.amplitude=function(t){return e(t,n*z)},r.period=function(n){return e(t,n)},r}(1,.3);e.easeLinear=t,e.easeQuad=o,e.easeQuadIn=n,e.easeQuadOut=r,e.easeQuadInOut=o,e.easeCubic=s,e.easeCubicIn=a,e.easeCubicOut=i,e.easeCubicInOut=s,e.easePoly=C,e.easePolyIn=w,e.easePolyOut=S,e.easePolyInOut=C,e.easeSin=c,e.easeSinIn=l,e.easeSinOut=u,e.easeSinInOut=c,e.easeExp=h,e.easeExpIn=d,e.easeExpOut=f,e.easeExpInOut=h,e.easeCircle=g,e.easeCircleIn=m,e.easeCircleOut=p,e.easeCircleInOut=g,e.easeBounce=y,e.easeBounceIn=v,e.easeBounceOut=y,e.easeBounceInOut=b,e.easeBack=j,e.easeBackIn=T,e.easeBackOut=H,e.easeBackInOut=j,e.easeElastic=U,e.easeElasticIn=V,e.easeElasticOut=U,e.easeElasticInOut=O,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-color")):"function"==typeof define&&define.amd?define(["exports","d3-color"],t):t(e.d3=e.d3||{},e.d3)}(this,function(e,t){"use strict";function n(e,t,n,r,o){var a=e*e,i=a*e;return((1-3*e+3*a-i)*t+(4-6*a+3*i)*n+(1+3*e+3*a-3*i)*r+i*o)/6}function r(e,t){return function(n){return e+n*t}}function o(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function a(e,t){var n=t-e;return n?r(e,n>180||n<-180?n-360*Math.round(n/360):n):x(isNaN(e)?t:e)}function i(e){return 1==(e=+e)?s:function(t,n){return n-t?o(t,n,e):x(isNaN(t)?n:t)}}function s(e,t){var n=t-e;return n?r(e,n):x(isNaN(e)?t:e)}function l(e){return function(n){var r,o,a=n.length,i=new Array(a),s=new Array(a),l=new Array(a);for(r=0;r<a;++r)o=t.rgb(n[r]),i[r]=o.r||0,s[r]=o.g||0,l[r]=o.b||0;return i=e(i),s=e(s),l=e(l),o.opacity=1,function(e){return o.r=i(e),o.g=s(e),o.b=l(e),o+""}}}function u(e){return function(){return e}}function c(e){return function(t){return e(t)+""}}function d(e){return"none"===e?O:(S||(S=document.createElement("DIV"),C=document.documentElement,M=document.defaultView),S.style.transform=e,e=M.getComputedStyle(C.appendChild(S),null).getPropertyValue("transform"),C.removeChild(S),e=e.slice(7,-1).split(","),F(+e[0],+e[1],+e[2],+e[3],+e[4],+e[5]))}function f(e){return null==e?O:(P||(P=document.createElementNS("http://www.w3.org/2000/svg","g")),P.setAttribute("transform",e),(e=P.transform.baseVal.consolidate())?(e=e.matrix,F(e.a,e.b,e.c,e.d,e.e,e.f)):O)}function h(e,t,n,r){function o(e){return e.length?e.pop()+" ":""}function a(e,r,o,a,i,s){if(e!==o||r!==a){var l=i.push("translate(",null,t,null,n);s.push({i:l-4,x:k(e,o)},{i:l-2,x:k(r,a)})}else(o||a)&&i.push("translate("+o+t+a+n)}function i(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(o(n)+"rotate(",null,r)-2,x:k(e,t)})):t&&n.push(o(n)+"rotate("+t+r)}function s(e,t,n,a){e!==t?a.push({i:n.push(o(n)+"skewX(",null,r)-2,x:k(e,t)}):t&&n.push(o(n)+"skewX("+t+r)}function l(e,t,n,r,a,i){if(e!==n||t!==r){var s=a.push(o(a)+"scale(",null,",",null,")");i.push({i:s-4,x:k(e,n)},{i:s-2,x:k(t,r)})}else 1===n&&1===r||a.push(o(a)+"scale("+n+","+r+")")}return function(t,n){var r=[],o=[];return t=e(t),n=e(n),a(t.translateX,t.translateY,n.translateX,n.translateY,r,o),i(t.rotate,n.rotate,r,o),s(t.skewX,n.skewX,r,o),l(t.scaleX,t.scaleY,n.scaleX,n.scaleY,r,o),t=n=null,function(e){for(var t,n=-1,a=o.length;++n<a;)r[(t=o[n]).i]=t.x(e);return r.join("")}}}function m(e){return((e=Math.exp(e))+1/e)/2}function p(e){return((e=Math.exp(e))-1/e)/2}function g(e){return((e=Math.exp(2*e))-1)/(e+1)}function v(e){return function(n,r){var o=e((n=t.hsl(n)).h,(r=t.hsl(r)).h),a=s(n.s,r.s),i=s(n.l,r.l),l=s(n.opacity,r.opacity);return function(e){return n.h=o(e),n.s=a(e),n.l=i(e),n.opacity=l(e),n+""}}}function y(e,n){var r=s((e=t.lab(e)).l,(n=t.lab(n)).l),o=s(e.a,n.a),a=s(e.b,n.b),i=s(e.opacity,n.opacity);return function(t){return e.l=r(t),e.a=o(t),e.b=a(t),e.opacity=i(t),e+""}}function b(e){return function(n,r){var o=e((n=t.hcl(n)).h,(r=t.hcl(r)).h),a=s(n.c,r.c),i=s(n.l,r.l),l=s(n.opacity,r.opacity);return function(e){return n.h=o(e),n.c=a(e),n.l=i(e),n.opacity=l(e),n+""}}}function w(e){return function n(r){function o(n,o){var a=e((n=t.cubehelix(n)).h,(o=t.cubehelix(o)).h),i=s(n.s,o.s),l=s(n.l,o.l),u=s(n.opacity,o.opacity);return function(e){return n.h=a(e),n.s=i(e),n.l=l(Math.pow(e,r)),n.opacity=u(e),n+""}}return r=+r,o.gamma=n,o}(1)}var S,C,M,P,N=function(e){var t=e.length-1;return function(r){var o=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),a=e[o],i=e[o+1],s=o>0?e[o-1]:2*a-i,l=o<t-1?e[o+2]:2*i-a;return n((r-o/t)*t,s,a,i,l)}},_=function(e){var t=e.length;return function(r){var o=Math.floor(((r%=1)<0?++r:r)*t),a=e[(o+t-1)%t],i=e[o%t],s=e[(o+1)%t],l=e[(o+2)%t];return n((r-o/t)*t,a,i,s,l)}},x=function(e){return function(){return e}},L=function e(n){function r(e,n){var r=o((e=t.rgb(e)).r,(n=t.rgb(n)).r),a=o(e.g,n.g),i=o(e.b,n.b),l=s(e.opacity,n.opacity);return function(t){return e.r=r(t),e.g=a(t),e.b=i(t),e.opacity=l(t),e+""}}var o=i(n);return r.gamma=e,r}(1),A=l(N),I=l(_),$=function(e,t){var n,r=t?t.length:0,o=e?Math.min(r,e.length):0,a=new Array(r),i=new Array(r);for(n=0;n<o;++n)a[n]=z(e[n],t[n]);for(;n<r;++n)i[n]=t[n];return function(e){for(n=0;n<o;++n)i[n]=a[n](e);return i}},D=function(e,t){var n=new Date;return e=+e,t-=e,function(r){return n.setTime(e+t*r),n}},k=function(e,t){return e=+e,t-=e,function(n){return e+t*n}},E=function(e,t){var n,r={},o={};null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={});for(n in t)n in e?r[n]=z(e[n],t[n]):o[n]=t[n];return function(e){for(n in r)o[n]=r[n](e);return o}},T=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,H=new RegExp(T.source,"g"),j=function(e,t){var n,r,o,a=T.lastIndex=H.lastIndex=0,i=-1,s=[],l=[];for(e+="",t+="";(n=T.exec(e))&&(r=H.exec(t));)(o=r.index)>a&&(o=t.slice(a,o),s[i]?s[i]+=o:s[++i]=o),(n=n[0])===(r=r[0])?s[i]?s[i]+=r:s[++i]=r:(s[++i]=null,l.push({i:i,x:k(n,r)})),a=H.lastIndex;return a<t.length&&(o=t.slice(a),s[i]?s[i]+=o:s[++i]=o),s.length<2?l[0]?c(l[0].x):u(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})},z=function(e,n){var r,o=typeof n;return null==n||"boolean"===o?x(n):("number"===o?k:"string"===o?(r=t.color(n))?(n=r,L):j:n instanceof t.color?L:n instanceof Date?D:Array.isArray(n)?$:"function"!=typeof n.valueOf&&"function"!=typeof n.toString||isNaN(n)?E:k)(e,n)},V=function(e,t){return e=+e,t-=e,function(n){return Math.round(e+t*n)}},U=180/Math.PI,O={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},F=function(e,t,n,r,o,a){var i,s,l;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,i=-i),{translateX:o,translateY:a,rotate:Math.atan2(t,e)*U,skewX:Math.atan(l)*U,scaleX:i,scaleY:s}},R=h(d,"px, ","px)","deg)"),B=h(f,", ",")",")"),q=Math.SQRT2,Z=function(e,t){var n,r,o=e[0],a=e[1],i=e[2],s=t[0],l=t[1],u=t[2],c=s-o,d=l-a,f=c*c+d*d;if(f<1e-12)r=Math.log(u/i)/q,n=function(e){return[o+e*c,a+e*d,i*Math.exp(q*e*r)]};else{var h=Math.sqrt(f),v=(u*u-i*i+4*f)/(2*i*2*h),y=(u*u-i*i-4*f)/(2*u*2*h),b=Math.log(Math.sqrt(v*v+1)-v),w=Math.log(Math.sqrt(y*y+1)-y);r=(w-b)/q,n=function(e){var t=e*r,n=m(b),s=i/(2*h)*(n*g(q*t+b)-p(b));return[o+s*c,a+s*d,i*n/m(q*t+b)]}}return n.duration=1e3*r,n},Q=v(a),Y=v(s),G=b(a),X=b(s),J=w(a),W=w(s),K=function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n};e.interpolate=z,e.interpolateArray=$,e.interpolateBasis=N,e.interpolateBasisClosed=_,e.interpolateDate=D,e.interpolateNumber=k,e.interpolateObject=E,e.interpolateRound=V,e.interpolateString=j,e.interpolateTransformCss=R,e.interpolateTransformSvg=B,e.interpolateZoom=Z,e.interpolateRgb=L,e.interpolateRgbBasis=A,e.interpolateRgbBasisClosed=I,e.interpolateHsl=Q,e.interpolateHslLong=Y,e.interpolateLab=y,e.interpolateHcl=G,e.interpolateHclLong=X,e.interpolateCubehelix=J,e.interpolateCubehelixLong=W,e.quantize=K,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";function t(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===K&&t.documentElement.namespaceURI===K?t.createElement(e):t.createElementNS(n,e)}}function n(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function r(){return new o}function o(){this._="@"+(++re).toString(36)}function a(e,t,n){return e=i(e,t,n),function(t){var n=t.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||e.call(this,t)}}function i(t,n,r){return function(o){var a=e.event;e.event=o;try{t.call(this,this.__data__,n,r)}finally{e.event=a}}}function s(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function l(e){return function(){var t=this.__on;if(t){for(var n,r=0,o=-1,a=t.length;r<a;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++o]=n:this.removeEventListener(n.type,n.listener,n.capture);++o?t.length=o:delete this.__on}}}function u(e,t,n){var r=le.hasOwnProperty(e.type)?a:i;return function(o,a,i){var s,l=this.__on,u=r(t,a,i);if(l)for(var c=0,d=l.length;c<d;++c)if((s=l[c]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=u,s.capture=n),void(s.value=t);this.addEventListener(e.type,u,n),s={type:e.type,name:e.name,value:t,listener:u,capture:n},l?l.push(s):this.__on=[s]}}function c(t,n,r,o){var a=e.event;t.sourceEvent=e.event,e.event=t;try{return n.apply(r,o)}finally{e.event=a}}function d(){}function f(){return[]}function h(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function m(e,t,n,r,o,a){for(var i,s=0,l=t.length,u=a.length;s<u;++s)(i=t[s])?(i.__data__=a[s],r[s]=i):n[s]=new h(e,a[s]);for(;s<l;++s)(i=t[s])&&(o[s]=i)}function p(e,t,n,r,o,a,i){var s,l,u,c={},d=t.length,f=a.length,m=new Array(d);for(s=0;s<d;++s)(l=t[s])&&(m[s]=u=Se+i.call(l,l.__data__,s,t),u in c?o[s]=l:c[u]=l);for(s=0;s<f;++s)u=Se+i.call(e,a[s],s,a),(l=c[u])?(r[s]=l,l.__data__=a[s],c[u]=null):n[s]=new h(e,a[s]);for(s=0;s<d;++s)(l=t[s])&&c[m[s]]===l&&(o[s]=l)}function g(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function v(e){return function(){this.removeAttribute(e)}}function y(e){return function(){this.removeAttributeNS(e.space,e.local)}}function b(e,t){return function(){this.setAttribute(e,t)}}function w(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function S(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function C(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function M(e){return function(){this.style.removeProperty(e)}}function P(e,t,n){return function(){this.style.setProperty(e,t,n)}}function N(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function _(e,t){return e.style.getPropertyValue(t)||Ee(e).getComputedStyle(e,null).getPropertyValue(t)}function x(e){return function(){delete this[e]}}function L(e,t){return function(){this[e]=t}}function A(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function I(e){return e.trim().split(/^|\s+/)}function $(e){return e.classList||new D(e)}function D(e){this._node=e,this._names=I(e.getAttribute("class")||"")}function k(e,t){for(var n=$(e),r=-1,o=t.length;++r<o;)n.add(t[r])}function E(e,t){for(var n=$(e),r=-1,o=t.length;++r<o;)n.remove(t[r])}function T(e){return function(){k(this,e)}}function H(e){return function(){E(this,e)}}function j(e,t){return function(){(t.apply(this,arguments)?k:E)(this,e)}}function z(){this.textContent=""}function V(e){return function(){this.textContent=e}}function U(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function O(){this.innerHTML=""}function F(e){return function(){this.innerHTML=e}}function R(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function B(){this.nextSibling&&this.parentNode.appendChild(this)}function q(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Z(){return null}function Q(){var e=this.parentNode;e&&e.removeChild(this)}function Y(e,t,n){var r=Ee(e),o=r.CustomEvent;"function"==typeof o?o=new o(t,n):(o=r.document.createEvent("Event"),n?(o.initEvent(t,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function G(e,t){return function(){return Y(this,e,t)}}function X(e,t){return function(){return Y(this,e,t.apply(this,arguments))}}function J(e,t){this._groups=e,this._parents=t}function W(){return new J([[document.documentElement]],Qe)}var K="http://www.w3.org/1999/xhtml",ee={svg:"http://www.w3.org/2000/svg",xhtml:K,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},te=function(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),ee.hasOwnProperty(t)?{space:ee[t],local:e}:e},ne=function(e){var r=te(e);return(r.local?n:t)(r)},re=0;o.prototype=r.prototype={constructor:o,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};var oe=function(e){return function(){return this.matches(e)}};if("undefined"!=typeof document){var ae=document.documentElement;if(!ae.matches){var ie=ae.webkitMatchesSelector||ae.msMatchesSelector||ae.mozMatchesSelector||ae.oMatchesSelector;oe=function(e){return function(){return ie.call(this,e)}}}}var se=oe,le={};e.event=null,"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(le={mouseenter:"mouseover",mouseleave:"mouseout"}));var ue=function(e,t,n){var r,o,a=s(e+""),i=a.length;if(!(arguments.length<2)){for(c=t?u:l,null==n&&(n=!1),r=0;r<i;++r)this.each(c(a[r],t,n));return this}var c=this.node().__on;if(c)for(var d,f=0,h=c.length;f<h;++f)for(r=0,d=c[f];r<i;++r)if((o=a[r]).type===d.type&&o.name===d.name)return d.value},ce=function(){for(var t,n=e.event;t=n.sourceEvent;)n=t;return n},de=function(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var o=e.getBoundingClientRect();return[t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop]},fe=function(e){var t=ce();return t.changedTouches&&(t=t.changedTouches[0]),de(e,t)},he=function(e){return null==e?d:function(){return this.querySelector(e)}},me=function(e){"function"!=typeof e&&(e=he(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var a,i,s=t[o],l=s.length,u=r[o]=new Array(l),c=0;c<l;++c)(a=s[c])&&(i=e.call(a,a.__data__,c,s))&&("__data__"in a&&(i.__data__=a.__data__),u[c]=i);return new J(r,this._parents)},pe=function(e){return null==e?f:function(){return this.querySelectorAll(e)}},ge=function(e){"function"!=typeof e&&(e=pe(e))
;for(var t=this._groups,n=t.length,r=[],o=[],a=0;a<n;++a)for(var i,s=t[a],l=s.length,u=0;u<l;++u)(i=s[u])&&(r.push(e.call(i,i.__data__,u,s)),o.push(i));return new J(r,o)},ve=function(e){"function"!=typeof e&&(e=se(e));for(var t=this._groups,n=t.length,r=new Array(n),o=0;o<n;++o)for(var a,i=t[o],s=i.length,l=r[o]=[],u=0;u<s;++u)(a=i[u])&&e.call(a,a.__data__,u,i)&&l.push(a);return new J(r,this._parents)},ye=function(e){return new Array(e.length)},be=function(){return new J(this._enter||this._groups.map(ye),this._parents)};h.prototype={constructor:h,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var we=function(e){return function(){return e}},Se="$",Ce=function(e,t){if(!e)return h=new Array(this.size()),u=-1,this.each(function(e){h[++u]=e}),h;var n=t?p:m,r=this._parents,o=this._groups;"function"!=typeof e&&(e=we(e));for(var a=o.length,i=new Array(a),s=new Array(a),l=new Array(a),u=0;u<a;++u){var c=r[u],d=o[u],f=d.length,h=e.call(c,c&&c.__data__,u,r),g=h.length,v=s[u]=new Array(g),y=i[u]=new Array(g);n(c,d,v,y,l[u]=new Array(f),h,t);for(var b,w,S=0,C=0;S<g;++S)if(b=v[S]){for(S>=C&&(C=S+1);!(w=y[C])&&++C<g;);b._next=w||null}}return i=new J(i,r),i._enter=s,i._exit=l,i},Me=function(){return new J(this._exit||this._groups.map(ye),this._parents)},Pe=function(e){for(var t=this._groups,n=e._groups,r=t.length,o=n.length,a=Math.min(r,o),i=new Array(r),s=0;s<a;++s)for(var l,u=t[s],c=n[s],d=u.length,f=i[s]=new Array(d),h=0;h<d;++h)(l=u[h]||c[h])&&(f[h]=l);for(;s<r;++s)i[s]=t[s];return new J(i,this._parents)},Ne=function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,o=e[t],a=o.length-1,i=o[a];--a>=0;)(r=o[a])&&(i&&i!==r.nextSibling&&i.parentNode.insertBefore(r,i),i=r);return this},_e=function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=g);for(var n=this._groups,r=n.length,o=new Array(r),a=0;a<r;++a){for(var i,s=n[a],l=s.length,u=o[a]=new Array(l),c=0;c<l;++c)(i=s[c])&&(u[c]=i);u.sort(t)}return new J(o,this._parents).order()},xe=function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},Le=function(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e},Ae=function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],o=0,a=r.length;o<a;++o){var i=r[o];if(i)return i}return null},Ie=function(){var e=0;return this.each(function(){++e}),e},$e=function(){return!this.node()},De=function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var o,a=t[n],i=0,s=a.length;i<s;++i)(o=a[i])&&e.call(o,o.__data__,i,a);return this},ke=function(e,t){var n=te(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?y:v:"function"==typeof t?n.local?C:S:n.local?w:b)(n,t))},Ee=function(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView},Te=function(e,t,n){return arguments.length>1?this.each((null==t?M:"function"==typeof t?N:P)(e,t,null==n?"":n)):_(this.node(),e)},He=function(e,t){return arguments.length>1?this.each((null==t?x:"function"==typeof t?A:L)(e,t)):this.node()[e]};D.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var je=function(e,t){var n=I(e+"");if(arguments.length<2){for(var r=$(this.node()),o=-1,a=n.length;++o<a;)if(!r.contains(n[o]))return!1;return!0}return this.each(("function"==typeof t?j:t?T:H)(n,t))},ze=function(e){return arguments.length?this.each(null==e?z:("function"==typeof e?U:V)(e)):this.node().textContent},Ve=function(e){return arguments.length?this.each(null==e?O:("function"==typeof e?R:F)(e)):this.node().innerHTML},Ue=function(){return this.each(B)},Oe=function(){return this.each(q)},Fe=function(e){var t="function"==typeof e?e:ne(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},Re=function(e,t){var n="function"==typeof e?e:ne(e),r=null==t?Z:"function"==typeof t?t:he(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},Be=function(){return this.each(Q)},qe=function(e){return arguments.length?this.property("__data__",e):this.node().__data__},Ze=function(e,t){return this.each(("function"==typeof t?X:G)(e,t))},Qe=[null];J.prototype=W.prototype={constructor:J,select:me,selectAll:ge,filter:ve,data:Ce,enter:be,exit:Me,merge:Pe,order:Ne,sort:_e,call:xe,nodes:Le,node:Ae,size:Ie,empty:$e,each:De,attr:ke,style:Te,property:He,classed:je,text:ze,html:Ve,raise:Ue,lower:Oe,append:Fe,insert:Re,remove:Be,datum:qe,on:ue,dispatch:Ze};var Ye=function(e){return"string"==typeof e?new J([[document.querySelector(e)]],[document.documentElement]):new J([[e]],Qe)},Ge=function(e){return"string"==typeof e?new J([document.querySelectorAll(e)],[document.documentElement]):new J([null==e?[]:e],Qe)},Xe=function(e,t,n){arguments.length<3&&(n=t,t=ce().changedTouches);for(var r,o=0,a=t?t.length:0;o<a;++o)if((r=t[o]).identifier===n)return de(e,r);return null},Je=function(e,t){null==t&&(t=ce().touches);for(var n=0,r=t?t.length:0,o=new Array(r);n<r;++n)o[n]=de(e,t[n]);return o};e.creator=ne,e.local=r,e.matcher=se,e.mouse=fe,e.namespace=te,e.namespaces=ee,e.select=Ye,e.selectAll=Ge,e.selection=W,e.selector=he,e.selectorAll=pe,e.style=_,e.touch=Xe,e.touches=Je,e.window=Ee,e.customEvent=c,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";function t(){return v||(w(n),v=b.now()+y)}function n(){v=0}function r(){this._call=this._time=this._next=null}function o(e,t,n){var o=new r;return o.restart(e,t,n),o}function a(){t(),++f;for(var e,n=c;n;)(e=v-n._time)>=0&&n._call.call(null,e),n=n._next;--f}function i(){v=(g=b.now())+y,f=h=0;try{a()}finally{f=0,l(),v=0}}function s(){var e=b.now(),t=e-g;t>p&&(y-=t,g=e)}function l(){for(var e,t,n=c,r=1/0;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:c=t);d=e,u(r)}function u(e){if(!f){h&&(h=clearTimeout(h));var t=e-v;t>24?(e<1/0&&(h=setTimeout(i,t)),m&&(m=clearInterval(m))):(m||(g=v,m=setInterval(s,p)),f=1,w(i))}}var c,d,f=0,h=0,m=0,p=1e3,g=0,v=0,y=0,b="object"==typeof performance&&performance.now?performance:Date,w="function"==typeof requestAnimationFrame?requestAnimationFrame:function(e){setTimeout(e,17)};r.prototype=o.prototype={constructor:r,restart:function(e,n,r){if("function"!=typeof e)throw new TypeError("callback is not a function");r=(null==r?t():+r)+(null==n?0:+n),this._next||d===this||(d?d._next=this:c=this,d=this),this._call=e,this._time=r,u()},stop:function(){this._call&&(this._call=null,this._time=1/0,u())}};var S=function(e,t,n){var o=new r;return t=null==t?0:+t,o.restart(function(n){o.stop(),e(n+t)},t,n),o},C=function(e,n,o){var a=new r,i=n;return null==n?(a.restart(e,n,o),a):(n=+n,o=null==o?t():+o,a.restart(function t(r){r+=i,a.restart(t,i+=n,o),e(r)},n,o),a)};e.now=t,e.timer=o,e.timerFlush=a,e.timeout=S,e.interval=C,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-selection"),require("d3-dispatch"),require("d3-timer"),require("d3-interpolate"),require("d3-color"),require("d3-ease")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-dispatch","d3-timer","d3-interpolate","d3-color","d3-ease"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,n,r,o,a,i){"use strict";function s(e,t){var n=e.__transition;if(!n||!(n=n[t])||n.state>R)throw new Error("too late");return n}function l(e,t){var n=e.__transition;if(!n||!(n=n[t])||n.state>q)throw new Error("too late");return n}function u(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("too late");return n}function c(e,t,n){function o(e){n.state=B,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)}function a(o){var c,d,f,h;if(n.state!==B)return s();for(c in u)if(h=u[c],h.name===n.name){if(h.state===Z)return r.timeout(a);h.state===Q?(h.state=G,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete u[c]):+c<t&&(h.state=G,h.timer.stop(),delete u[c])}if(r.timeout(function(){n.state===Z&&(n.state=Q,n.timer.restart(i,n.delay,n.time),i(o))}),n.state=q,n.on.call("start",e,e.__data__,n.index,n.group),n.state===q){for(n.state=Z,l=new Array(f=n.tween.length),c=0,d=-1;c<f;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(l[++d]=h);l.length=d+1}}function i(t){for(var r=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(s),n.state=Y,1),o=-1,a=l.length;++o<a;)l[o].call(null,r);n.state===Y&&(n.on.call("end",e,e.__data__,n.index,n.group),s())}function s(){n.state=G,n.timer.stop(),delete u[t];for(var r in u)return;delete e.__transition}var l,u=e.__transition;u[t]=n,n.timer=r.timer(o,0,n.time)}function d(e,t){var n,r;return function(){var o=l(this,e),a=o.tween;if(a!==n){r=n=a;for(var i=0,s=r.length;i<s;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function f(e,t,n){var r,o;if("function"!=typeof n)throw new Error;return function(){var a=l(this,e),i=a.tween;if(i!==r){o=(r=i).slice();for(var s={name:t,value:n},u=0,c=o.length;u<c;++u)if(o[u].name===t){o[u]=s;break}u===c&&o.push(s)}a.tween=o}}function h(e,t,n){var r=e._id;return e.each(function(){var e=l(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return u(e,r).value[t]}}function m(e){return function(){this.removeAttribute(e)}}function p(e){return function(){this.removeAttributeNS(e.space,e.local)}}function g(e,t,n){var r,o;return function(){var a=this.getAttribute(e);return a===n?null:a===r?o:o=t(r=a,n)}}function v(e,t,n){var r,o;return function(){var a=this.getAttributeNS(e.space,e.local);return a===n?null:a===r?o:o=t(r=a,n)}}function y(e,t,n){var r,o,a;return function(){var i,s=n(this);return null==s?void this.removeAttribute(e):(i=this.getAttribute(e),i===s?null:i===r&&s===o?a:a=t(r=i,o=s))}}function b(e,t,n){var r,o,a;return function(){var i,s=n(this);return null==s?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),i===s?null:i===r&&s===o?a:a=t(r=i,o=s))}}function w(e,t){function n(){var n=this,r=t.apply(n,arguments);return r&&function(t){n.setAttributeNS(e.space,e.local,r(t))}}return n._value=t,n}function S(e,t){function n(){var n=this,r=t.apply(n,arguments);return r&&function(t){n.setAttribute(e,r(t))}}return n._value=t,n}function C(e,t){return function(){s(this,e).delay=+t.apply(this,arguments)}}function M(e,t){return t=+t,function(){s(this,e).delay=t}}function P(e,t){return function(){l(this,e).duration=+t.apply(this,arguments)}}function N(e,t){return t=+t,function(){l(this,e).duration=t}}function _(e,t){if("function"!=typeof t)throw new Error;return function(){l(this,e).ease=t}}function x(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}function L(e,t,n){var r,o,a=x(t)?s:l;return function(){var i=a(this,e),s=i.on;s!==r&&(o=(r=s).copy()).on(t,n),i.on=o}}function A(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function I(e,n){var r,o,a;return function(){var i=t.style(this,e),s=(this.style.removeProperty(e),t.style(this,e));return i===s?null:i===r&&s===o?a:a=n(r=i,o=s)}}function $(e){return function(){this.style.removeProperty(e)}}function D(e,n,r){var o,a;return function(){var i=t.style(this,e);return i===r?null:i===o?a:a=n(o=i,r)}}function k(e,n,r){var o,a,i;return function(){var s=t.style(this,e),l=r(this);return null==l&&(this.style.removeProperty(e),l=t.style(this,e)),s===l?null:s===o&&l===a?i:i=n(o=s,a=l)}}function E(e,t,n){function r(){var r=this,o=t.apply(r,arguments);return o&&function(t){r.style.setProperty(e,o(t),n)}}return r._value=t,r}function T(e){return function(){this.textContent=e}}function H(e){return function(){var t=e(this);this.textContent=null==t?"":t}}function j(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function z(e){return t.selection().transition(e)}function V(){return++ye}function U(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))return we.time=r.now(),we;return n}var O=n.dispatch("start","end","interrupt"),F=[],R=0,B=1,q=2,Z=3,Q=4,Y=5,G=6,X=function(e,t,n,r,o,a){var i=e.__transition;if(i){if(n in i)return}else e.__transition={};c(e,n,{name:t,index:r,group:o,on:O,tween:F,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:R})},J=function(e,t){var n,r,o,a=e.__transition,i=!0;if(a){t=null==t?null:t+"";for(o in a)(n=a[o]).name===t?(r=n.state>q&&n.state<Y,n.state=G,n.timer.stop(),r&&n.on.call("interrupt",e,e.__data__,n.index,n.group),delete a[o]):i=!1;i&&delete e.__transition}},W=function(e){return this.each(function(){J(this,e)})},K=function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,o=u(this.node(),n).tween,a=0,i=o.length;a<i;++a)if((r=o[a]).name===e)return r.value;return null}return this.each((null==t?d:f)(n,e,t))},ee=function(e,t){var n;return("number"==typeof t?o.interpolateNumber:t instanceof a.color?o.interpolateRgb:(n=a.color(t))?(t=n,o.interpolateRgb):o.interpolateString)(e,t)},te=function(e,n){var r=t.namespace(e),a="transform"===r?o.interpolateTransformSvg:ee;return this.attrTween(e,"function"==typeof n?(r.local?b:y)(r,a,h(this,"attr."+e,n)):null==n?(r.local?p:m)(r):(r.local?v:g)(r,a,n+""))},ne=function(e,n){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==n)return this.tween(r,null);if("function"!=typeof n)throw new Error;var o=t.namespace(e);return this.tween(r,(o.local?w:S)(o,n))},re=function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?C:M)(t,e)):u(this.node(),t).delay},oe=function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?P:N)(t,e)):u(this.node(),t).duration},ae=function(e){var t=this._id;return arguments.length?this.each(_(t,e)):u(this.node(),t).ease},ie=function(e){"function"!=typeof e&&(e=t.matcher(e));for(var n=this._groups,r=n.length,o=new Array(r),a=0;a<r;++a)for(var i,s=n[a],l=s.length,u=o[a]=[],c=0;c<l;++c)(i=s[c])&&e.call(i,i.__data__,c,s)&&u.push(i);return new j(o,this._parents,this._name,this._id)},se=function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=n.length,a=Math.min(r,o),i=new Array(r),s=0;s<a;++s)for(var l,u=t[s],c=n[s],d=u.length,f=i[s]=new Array(d),h=0;h<d;++h)(l=u[h]||c[h])&&(f[h]=l);for(;s<r;++s)i[s]=t[s];return new j(i,this._parents,this._name,this._id)},le=function(e,t){var n=this._id;return arguments.length<2?u(this.node(),n).on.on(e):this.each(L(n,e,t))},ue=function(){return this.on("end.remove",A(this._id))},ce=function(e){var n=this._name,r=this._id;"function"!=typeof e&&(e=t.selector(e));for(var o=this._groups,a=o.length,i=new Array(a),s=0;s<a;++s)for(var l,c,d=o[s],f=d.length,h=i[s]=new Array(f),m=0;m<f;++m)(l=d[m])&&(c=e.call(l,l.__data__,m,d))&&("__data__"in l&&(c.__data__=l.__data__),h[m]=c,X(h[m],n,r,m,h,u(l,r)));return new j(i,this._parents,n,r)},de=function(e){var n=this._name,r=this._id;"function"!=typeof e&&(e=t.selectorAll(e));for(var o=this._groups,a=o.length,i=[],s=[],l=0;l<a;++l)for(var c,d=o[l],f=d.length,h=0;h<f;++h)if(c=d[h]){for(var m,p=e.call(c,c.__data__,h,d),g=u(c,r),v=0,y=p.length;v<y;++v)(m=p[v])&&X(m,n,r,v,p,g);i.push(p),s.push(c)}return new j(i,s,n,r)},fe=t.selection.prototype.constructor,he=function(){return new fe(this._groups,this._parents)},me=function(e,t,n){var r="transform"==(e+="")?o.interpolateTransformCss:ee;return null==t?this.styleTween(e,I(e,r)).on("end.style."+e,$(e)):this.styleTween(e,"function"==typeof t?k(e,r,h(this,"style."+e,t)):D(e,r,t+""),n)},pe=function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,E(e,t,null==n?"":n))},ge=function(e){return this.tween("text","function"==typeof e?H(h(this,"text",e)):T(null==e?"":e+""))},ve=function(){for(var e=this._name,t=this._id,n=V(),r=this._groups,o=r.length,a=0;a<o;++a)for(var i,s=r[a],l=s.length,c=0;c<l;++c)if(i=s[c]){var d=u(i,t);X(i,e,n,c,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new j(r,this._parents,e,n)},ye=0,be=t.selection.prototype;j.prototype=z.prototype={constructor:j,select:ce,selectAll:de,filter:ie,merge:se,selection:he,transition:ve,call:be.call,nodes:be.nodes,node:be.node,size:be.size,empty:be.empty,each:be.each,on:le,attr:te,attrTween:ne,style:me,styleTween:pe,text:ge,remove:ue,tween:K,delay:re,duration:oe,ease:ae};var we={time:null,delay:0,duration:250,ease:i.easeCubicInOut},Se=function(e){var t,n;e instanceof j?(t=e._id,e=e._name):(t=V(),(n=we).time=r.now(),e=null==e?null:e+"");for(var o=this._groups,a=o.length,i=0;i<a;++i)for(var s,l=o[i],u=l.length,c=0;c<u;++c)(s=l[c])&&X(s,e,t,c,l,n||U(s,t));return new j(o,this._parents,e,t)};t.selection.prototype.interrupt=W,t.selection.prototype.transition=Se;var Ce=[null],Me=function(e,t){var n,r,o=e.__transition;if(o){t=null==t?null:t+"";for(r in o)if((n=o[r]).state>B&&n.name===t)return new j([[e]],Ce,t,+r)}return null};e.transition=z,e.active=Me,e.interrupt=J,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,n,r,o,a){"use strict";function i(e,t,n){this.target=e,this.type=t,this.transform=n}function s(e,t,n){this.k=e,this.x=t,this.y=n}function l(e){return e.__zoom||m}function u(){o.event.stopImmediatePropagation()}function c(){return!o.event.button}function d(){var e,t,n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,e=n.width.baseVal.value,t=n.height.baseVal.value):(e=n.clientWidth,t=n.clientHeight),[[0,0],[e,t]]}function f(){return this.__zoom||m}var h=function(e){return function(){return e}};s.prototype={constructor:s,scale:function(e){return 1===e?this:new s(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new s(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var m=new s(1,0,0);l.prototype=s.prototype;var p=function(){o.event.preventDefault(),o.event.stopImmediatePropagation()},g=function(){function e(e){e.on("wheel.zoom",S).on("mousedown.zoom",C).on("dblclick.zoom",M).on("touchstart.zoom",P).on("touchmove.zoom",N).on("touchend.zoom touchcancel.zoom",_).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",f)}function l(e,t){return t=Math.max($,Math.min(D,t)),t===e.k?e:new s(t,e.x,e.y)}function m(e,t,n){var r=t[0]-n[0]*e.k,o=t[1]-n[1]*e.k;return r===e.x&&o===e.y?e:new s(e.k,r,o)}function g(e,t){var n=e.invertX(t[0][0])-k,r=e.invertX(t[1][0])-E,o=e.invertY(t[0][1])-T,a=e.invertY(t[1][1])-H;return e.translate(r>n?(n+r)/2:Math.min(0,n)||Math.max(0,r),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function v(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function y(e,t,n){e.on("start.zoom",function(){b(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).end()}).tween("zoom",function(){var e=this,r=arguments,o=b(e,r),a=I.apply(e,r),i=n||v(a),l=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),u=e.__zoom,c="function"==typeof t?t.apply(e,r):t,d=z(u.invert(i).concat(l/u.k),c.invert(i).concat(l/c.k));return function(e){if(1===e)e=c;else{var t=d(e),n=l/t[2];e=new s(n,i[0]-t[0]*n,i[1]-t[1]*n)}o.zoom(null,e)}})}function b(e,t){for(var n,r=0,o=V.length;r<o;++r)if((n=V[r]).that===e)return n;return new w(e,t)}function w(e,t){this.that=e,this.args=t,this.index=-1,this.active=0,this.extent=I.apply(e,t)}function S(){function e(){t.wheel=null,t.end()}if(A.apply(this,arguments)){var t=b(this,arguments),n=this.__zoom,r=Math.max($,Math.min(D,n.k*Math.pow(2,-o.event.deltaY*(o.event.deltaMode?120:1)/500))),i=o.mouse(this);if(t.wheel)t.mouse[0][0]===i[0]&&t.mouse[0][1]===i[1]||(t.mouse[1]=n.invert(t.mouse[0]=i)),clearTimeout(t.wheel);else{if(n.k===r)return;t.mouse=[i,n.invert(i)],a.interrupt(this),t.start()}p(),t.wheel=setTimeout(e,F),t.zoom("mouse",g(m(l(n,r),t.mouse[0],t.mouse[1]),t.extent))}}function C(){function e(){if(p(),!r.moved){var e=o.event.clientX-l,t=o.event.clientY-c;r.moved=e*e+t*t>R}r.zoom("mouse",g(m(r.that.__zoom,r.mouse[0]=o.mouse(r.that),r.mouse[1]),r.extent))}function t(){i.on("mousemove.zoom mouseup.zoom",null),n.dragEnable(o.event.view,r.moved),p(),r.end()}if(!L&&A.apply(this,arguments)){var r=b(this,arguments),i=o.select(o.event.view).on("mousemove.zoom",e,!0).on("mouseup.zoom",t,!0),s=o.mouse(this),l=o.event.clientX,c=o.event.clientY;n.dragDisable(o.event.view),u(),r.mouse=[s,this.__zoom.invert(s)],a.interrupt(this),r.start()}}function M(){if(A.apply(this,arguments)){var t=this.__zoom,n=o.mouse(this),r=t.invert(n),a=t.k*(o.event.shiftKey?.5:2),i=g(m(l(t,a),n,r),I.apply(this,arguments));p(),j>0?o.select(this).transition().duration(j).call(y,i,n):o.select(this).call(e.transform,i)}}function P(){if(A.apply(this,arguments)){var e,t,n,r,i=b(this,arguments),s=o.event.changedTouches,l=s.length;for(u(),t=0;t<l;++t)n=s[t],r=o.touch(this,s,n.identifier),r=[r,this.__zoom.invert(r),n.identifier],i.touch0?i.touch1||(i.touch1=r):(i.touch0=r,e=!0);if(x&&(x=clearTimeout(x),!i.touch1))return i.end(),void((r=o.select(this).on("dblclick.zoom"))&&r.apply(this,arguments));e&&(x=setTimeout(function(){x=null},O),a.interrupt(this),i.start())}}function N(){var e,t,n,r,a=b(this,arguments),i=o.event.changedTouches,s=i.length;for(p(),x&&(x=clearTimeout(x)),e=0;e<s;++e)t=i[e],n=o.touch(this,i,t.identifier),a.touch0&&a.touch0[2]===t.identifier?a.touch0[0]=n:a.touch1&&a.touch1[2]===t.identifier&&(a.touch1[0]=n);if(t=a.that.__zoom,a.touch1){var u=a.touch0[0],c=a.touch0[1],d=a.touch1[0],f=a.touch1[1],h=(h=d[0]-u[0])*h+(h=d[1]-u[1])*h,v=(v=f[0]-c[0])*v+(v=f[1]-c[1])*v;t=l(t,Math.sqrt(h/v)),n=[(u[0]+d[0])/2,(u[1]+d[1])/2],r=[(c[0]+f[0])/2,(c[1]+f[1])/2]}else{if(!a.touch0)return;n=a.touch0[0],r=a.touch0[1]}a.zoom("touch",g(m(t,n,r),a.extent))}function _(){var e,t,n=b(this,arguments),r=o.event.changedTouches,a=r.length;for(u(),L&&clearTimeout(L),L=setTimeout(function(){L=null},O),e=0;e<a;++e)t=r[e],n.touch0&&n.touch0[2]===t.identifier?delete n.touch0:n.touch1&&n.touch1[2]===t.identifier&&delete n.touch1;n.touch1&&!n.touch0&&(n.touch0=n.touch1,delete n.touch1),n.touch0?n.touch0[1]=this.__zoom.invert(n.touch0[0]):n.end()}var x,L,A=c,I=d,$=0,D=1/0,k=-D,E=D,T=k,H=E,j=250,z=r.interpolateZoom,V=[],U=t.dispatch("start","zoom","end"),O=500,F=150,R=0;return e.transform=function(e,t){var n=e.selection?e.selection():e;n.property("__zoom",f),e!==n?y(e,t):n.interrupt().each(function(){b(this,arguments).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},e.scaleBy=function(t,n){e.scaleTo(t,function(){return this.__zoom.k*("function"==typeof n?n.apply(this,arguments):n)})},e.scaleTo=function(t,n){e.transform(t,function(){var e=I.apply(this,arguments),t=this.__zoom,r=v(e),o=t.invert(r);return g(m(l(t,"function"==typeof n?n.apply(this,arguments):n),r,o),e)})},e.translateBy=function(t,n,r){e.transform(t,function(){return g(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof r?r.apply(this,arguments):r),I.apply(this,arguments))})},w.prototype={start:function(){return 1==++this.active&&(this.index=V.push(this)-1,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(V.splice(this.index,1),this.index=-1,this.emit("end")),this},emit:function(t){o.customEvent(new i(e,t,this.that.__zoom),U.apply,U,[t,this.that,this.args])}},e.filter=function(t){return arguments.length?(A="function"==typeof t?t:h(!!t),e):A},e.extent=function(t){return arguments.length?(I="function"==typeof t?t:h([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),e):I},e.scaleExtent=function(t){return arguments.length?($=+t[0],D=+t[1],e):[$,D]},e.translateExtent=function(t){return arguments.length?(k=+t[0][0],E=+t[1][0],T=+t[0][1],H=+t[1][1],e):[[k,T],[E,H]]},e.duration=function(t){return arguments.length?(j=+t,e):j},e.interpolate=function(t){return arguments.length?(z=t,e):z},e.on=function(){var t=U.on.apply(U,arguments);return t===U?e:t},e.clickDistance=function(t){return arguments.length?(R=(t=+t)*t,e):Math.sqrt(R)},e};e.zoom=g,e.zoomTransform=l,e.zoomIdentity=m,Object.defineProperty(e,"__esModule",{value:!0})});var global;try{global=Function("return this")()||(0,eval)("this")}catch(e){global=window}global.global=global,function(e){function t(e){function t(e,t){return d[e]={validators:[].concat(t),error:null},this}function n(e,t){return 1===arguments.length?(d[e]||{}).error||null:2===arguments.length?(d[e]||{}).error=t||null:void 0}function r(){u(arguments).forEach(function(e){d[e].error=null})}function o(){var e=!0;return u(arguments).forEach(function(t){c(t,d[t].validators)&&(e=!1)}),e}function a(){var e=!0;return u(arguments).forEach(function(t){var n=d[t];n.error=n.error&&c(t,n.validators),n.error&&(e=!1)}),e}function i(){var e=!0;return u(arguments).forEach(function(t){var n=d[t];n.error=c(t,n.validators),n.error&&(e=!1)}),e}function s(){var e=!0;return u(arguments).forEach(function(t){d[t].error&&(e=!1)}),e}function l(e){Object.keys(d).forEach(function(t){d[t].error=e[t]||null})}function u(e){var t=Object.keys(d);return e.length?Array.from(e).filter(function(e){return t.indexOf(e)>=0}):t}function c(t,n){if(!n)return null;for(var r=e[t],o=0;o<n.length;o++){var a=n[o](r);if(!0===a)break;if(a)return a}return null}var d={};this.field=t,this.error=n,this.clear=r,this.see=o,this.check=a,this.validate=i,this.status=s,this.dictate=l}function n(e){return e=e||"پُر کردن این فیلد الزامی است",function(t){return t?null:e}}function r(){return function(e){return!e}}function o(e){return e=e||"کد ملی صحیح نمی باشد",function(t){return/^[0-9]{10}$/.test(t)?null:e}}function a(e,t){return t=t||"کد وارد شده صحیح نمی باشد",function(n){return String(n).length===e&&/^[0-9]+$/.test(n)?null:t}}function i(e){return e=e||"شماره تلفن وارد شده صحیح نمی باشد",function(t){return/^(\+98)?[0-9]{5,15}$/.test(t)?null:e}}function s(e){return e=e||"شماره موبایل وارد شده صحیح نمی باشد",function(t){return/^(\+989|09)[0-9]{9}$/.test(t)?null:e}}function l(e,t){return t=t||"این فیلد باید حداقل "+toPersianNumber(e)+" حرف داشته باشد",function(n){return String(n).length>=e?null:t}}function u(e,t){return t=t||"این فیلد باید دقیقاً "+toPersianNumber(e)+" حرف داشته باشد",function(n){return String(n).length===e?null:t}}function c(e){return e=e||"نام کاربری فقط باید شامل حروف لاتین، ارقام، نقطه و خط زیر _ باشد",function(t){return/^[a-zA-Z_][a-zA-Z_0-9]+$/.test(t)?null:e}}function d(e){return e=e||"در این فیلد فقط استفاده از ارقام مجاز است",function(t){return/^[0-9]*$/.test(t)?null:e}}function f(e){return e=e||"آدرس وب سایت صحیح نمی باشد",function(t){return/^((http|https):\/\/)?[a-zA-Z0-9-_\.]+\.[a-zA-Z0-9]+$/.test(t)?null:e}}function h(e){return e=e||"پست الکترونیکی صحیح نمی باشد",function(t){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)?null:e}}e.ValidationSystem=t,t.validators={notEmpty:n,notRequired:r,nationalCode:o,numberCode:a,phoneNumber:i,mobilePhoneNumber:s,minLength:l,length:u,username:c,integer:d,url:f,email:h}}(global),function(){function e(e){var t=e[0],n=e[1],r=e[2],o=[0,31,59,90,120,151,181,212,243,273,304,334],a=t<=1600?0:979;t-=t<=1600?621:1600;var i=n>2?t+1:t,s=365*t+parseInt((i+3)/4,10)-parseInt((i+99)/100,10)+parseInt((i+399)/400,10)-80+r+o[n-1];return a+=33*parseInt(s/12053,10),s%=12053,a+=4*parseInt(s/1461,10),s%=1461,a+=parseInt((s-1)/365,10),s>365&&(s=(s-1)%365),[a,s<186?1+parseInt(s/31,10):7+parseInt((s-186)/30,10),1+(s<186?s%31:(s-186)%30)]}function t(e){var t=e[0],n=e[1],r=e[2],o=t<=979?621:1600;t-=t<=979?0:979;var a=365*t+8*parseInt(t/33,10)+parseInt((t%33+3)/4,10)+78+r+(n<7?31*(n-1):30*(n-7)+186);o+=400*parseInt(a/146097,10),a%=146097,a>36524&&(o+=100*parseInt(--a/36524,10),(a%=36524)>=365&&a++),o+=4*parseInt(a/1461,10),a%=1461,o+=parseInt((a-1)/365,10),a>365&&(a=(a-1)%365);for(var i=a+1,s=[0,31,o%4==0&&o%100!=0||o%400==0?29:28,31,30,31,30,31,31,30,31,30,31],l=0;l<13;l++){var u=s[l];if(i<=u)break;i-=u}return[o,l,i]}global.gregorianToJalali=e,global.jalaliToGregorian=t}(),function(){function e(){return[this.getFullYear(),this.getMonth()+1,this.getDate()]}function t(){return gregorianToJalali(this.gYMD())}function n(){return this.getTime()===this.getTime()}function r(e){var t=new Date(this);t.setMinutes(t.getMinutes()-t.getTimezoneOffset());var n=t.toISOString().slice(0,-1);if(!e){var r=this.toString(),o=r.indexOf("GMT")+3;n+="O"+r.slice(o,o+5)}return n}function o(){return new Date(Date.parse(this))}function a(){var e=this.replace(/\s/g,"");return"+98"===e.slice(0,3)&&(e="0"+e.slice(3)),e.split("").filter(function(e){return"0123456789".indexOf(e)>=0}).join("")}function i(){var e=this.toPhoneNumber();return 11===e.length&&"09"===e.slice(0,2)}function s(e,t,n){if(n=n||1,"number"!=typeof e||"number"!=typeof t||"number"!=typeof n)throw new Error("Provided from & to & step are not all numbers.");n<0&&(n=-n);var r=[];if(e<=t)for(;e<=t;)r.push(e++);else for(;e>=t;)r.push(e--);return r}function l(e){return e?Array.prototype.slice.call(e):[]}Date.prototype.gYMD=e,Date.prototype.jYMD=t,Date.prototype.isValid=n,Date.prototype.toLocalString=r,Date.parse=function(){var e=Date.parse;return function(t){if("string"==typeof(t=(t||"").toString())&&"O"===t.slice(-6,-5)){var n=t.slice(-5),r=60*Number(n.slice(1,3))+Number(n.slice(3,5));return"-"===n.slice(0,1)&&(r=-r),e(t.slice(0,-6)+"Z")-60*r*1e3}return e(t)}}(),String.prototype.toDate=o,String.prototype.toPhoneNumber=a,String.prototype.isMobileNumber=i,Array.range=s,Array.from=l}(),function(e){function t(e){return o[e]||a}function n(e){e=e||{},Object.keys(e).forEach(function(t){o[t]=e[t]})}function r(e){function n(t){for(var n=0;n<t.length;n++)if(e.slice(-1-t[n].length)==="."+t[n])return!0;return!1}var r="free file";return n(["doc","docx"])&&(r="doc file"),n(["xls","xlsx"])&&(r="xls file"),n(["pdf"])&&(r="pdf file"),t(r)}t.feed=n,t.file=r,e.iconJs=t;var o={
"left arrow":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJDYXBhXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgMzEuNDk0IDMxLjQ5NCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzEuNDk0IDMxLjQ5NDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggc3R5bGU9ImZpbGw6IzFFMjAxRDsiIGQ9Ik0xMC4yNzMsNS4wMDljMC40NDQtMC40NDQsMS4xNDMtMC40NDQsMS41ODcsMGMwLjQyOSwwLjQyOSwwLjQyOSwxLjE0MywwLDEuNTcxbC04LjA0Nyw4LjA0N2gyNi41NTQNCgljMC42MTksMCwxLjEyNywwLjQ5MiwxLjEyNywxLjExMWMwLDAuNjE5LTAuNTA4LDEuMTI3LTEuMTI3LDEuMTI3SDMuODEzbDguMDQ3LDguMDMyYzAuNDI5LDAuNDQ0LDAuNDI5LDEuMTU5LDAsMS41ODcNCgljLTAuNDQ0LDAuNDQ0LTEuMTQzLDAuNDQ0LTEuNTg3LDBsLTkuOTUyLTkuOTUyYy0wLjQyOS0wLjQyOS0wLjQyOS0xLjE0MywwLTEuNTcxTDEwLjI3Myw1LjAwOXoiLz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjwvc3ZnPg0K","menu bars":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0ndXRmLTgnPz4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgJy0vL1czQy8vRFREIFNWRyAxLjEvL0VOJyAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz4KPHN2ZyB3aWR0aD0iNjQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBoZWlnaHQ9IjY0IiB2aWV3Qm94PSIwIDAgNjQgNjQiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA2NCA2NCI+CiAgPGc+CiAgICA8ZyBmaWxsPSIjMUQxRDFCIj4KICAgICAgPHBhdGggZD0iTTIuMjUyLDEwLjI3MWg1OC44NzFjMS4xMjQsMCwyLjAzNC0wLjkxLDIuMDM0LTIuMDM0YzAtMS4xMjMtMC45MS0yLjAzNC0yLjAzNC0yLjAzNEgyLjI1MiAgICBjLTEuMTI0LDAtMi4wMzQsMC45MTEtMi4wMzQsMi4wMzRDMC4yMTgsOS4zNiwxLjEyOCwxMC4yNzEsMi4yNTIsMTAuMjcxeiIvPgogICAgICA8cGF0aCBkPSJtNjEuMTIzLDMwLjAxNWgtNTguODcxYy0xLjEyNCwwLTIuMDM0LDAuOTEyLTIuMDM0LDIuMDM1IDAsMS4xMjIgMC45MSwyLjAzNCAyLjAzNCwyLjAzNGg1OC44NzFjMS4xMjQsMCAyLjAzNC0wLjkxMiAyLjAzNC0yLjAzNC03LjEwNTQzZS0xNS0xLjEyMy0wLjkxLTIuMDM1LTIuMDM0LTIuMDM1eiIvPgogICAgICA8cGF0aCBkPSJtNjEuMTIzLDUzLjg3NmgtNTguODcxYy0xLjEyNCwwLTIuMDM0LDAuOTEtMi4wMzQsMi4wMzQgMCwxLjEyMyAwLjkxLDIuMDM0IDIuMDM0LDIuMDM0aDU4Ljg3MWMxLjEyNCwwIDIuMDM0LTAuOTExIDIuMDM0LTIuMDM0LTcuMTA1NDNlLTE1LTEuMTI0LTAuOTEtMi4wMzQtMi4wMzQtMi4wMzR6Ii8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"},a="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgICB2aWV3Qm94PSIwIDAgNTAwIDUwMCIgd2lkdGg9IjUwMCIgaGVpZ2h0PSI1MDAiIGlkPSJzdGFydGVyX3N2ZyI+ICAgPC9zdmc+"}(global),function(e){function t(e){return e=String(e||""),e.split("").map(function(e){return void 0!=n[e]?n[e]:e}).join("")}e.toPersianNumber=t;var n={0:"۰",1:"۱",2:"۲",3:"۳",4:"۴",5:"۵",6:"۶",7:"۷",8:"۸",9:"۹"}}(global);var app=angular.module("JavabAzmayesh",["ui.router","vcRecaptcha"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider","$compileProvider",function(e,t,n,r){e.state("home",{url:"/home",views:{"":{templateUrl:"home.html",controller:"HomeController"},menu:{templateUrl:"home/menu.html"},footer:{templateUrl:"home/footer.html"}},abstract:!0}).state("home.find",{url:"/find",templateUrl:"home/find.html",controller:"HomeFindController"}).state("home.otp",{url:"/otp",templateUrl:"home/otp.html",controller:"HomeOtpController"}).state("home.history",{url:"/history",params:{nationalCode:null,otpId:null,requestCode:null},templateUrl:"home/history.html",controller:"HomeHistoryController"}).state("home.about",{url:"/about",params:{previousState:null},templateUrl:"common/about.html",controller:"CommonAboutController",data:{dependencies:["container.rtl.min.css"]}}).state("home.contact",{url:"/contact",params:{previousState:null},templateUrl:"common/contact.html",controller:"CommonContactController",data:{dependencies:["container.rtl.min.css"]}}),e.state("history",{url:"/history",params:{nationalCode:null},views:{"":{templateUrl:"history.html",controller:"HistoryController"},header:{templateUrl:"history/header.html"}},data:{dependencies:["card.rtl.min.css"]}}),e.state("answer",{url:"/answer?p&n",params:{previousState:null,previousStateData:null},views:{"":{templateUrl:"answer.html",controller:"AnswerController"},menu:{templateUrl:"answer/menu.html"},header:{templateUrl:"answer/header.html"},footer:{templateUrl:"answer/footer.html"}}}).state("answer.post",{url:"/post",templateUrl:"answer/post.html"}).state("answer.download",{url:"/download",templateUrl:"answer/download.html"}).state("answer.share",{url:"/share",templateUrl:"answer/share.html"}).state("answer.laboratory",{url:"/laboratory",templateUrl:"answer/laboratory.html"}),e.state("lab",{url:"/lab",views:{"":{templateUrl:"lab.html",controller:"LabController"},menu:{templateUrl:"lab/menu.html"},footer:{templateUrl:"lab/footer.html"}},abstract:!0}).state("lab.login",{url:"/login",templateUrl:"lab/login.html",controller:"LabLoginController"}).state("lab.register",{url:"/register",params:{username:null},templateUrl:"lab/register.html",controller:"LabRegisterController",data:{dependencies:["checkbox.min.js","checkbox.rtl.min.css"]}}).state("lab.validate",{url:"/validate",params:{username:null},templateUrl:"lab/validate.html",controller:"LabValidateController"}).state("lab.signedup",{url:"/signedup",templateUrl:"lab/signedup.html"}).state("lab.forget",{url:"/forget",templateUrl:"lab/forget.html",controller:"LabForgetController"}).state("lab.password",{url:"/password",templateUrl:"lab/password.html"}).state("lab.about",{url:"/about",params:{previousState:null},templateUrl:"common/about.html",controller:"CommonAboutController",data:{dependencies:["container.rtl.min.css"]}}).state("lab.contact",{url:"/contact",params:{previousState:null},templateUrl:"common/contact.html",controller:"CommonContactController",data:{dependencies:["container.rtl.min.css"]}}),e.state("panel",{url:"/panel",views:{"":{templateUrl:"panel.html",controller:"PanelController"},menu:{templateUrl:"panel/menu.html"},header:{templateUrl:"panel/header.html"}},abstract:!0,data:{dependencies:["loader.rtl.min.css"]}}).state("panel.home",{url:"/home",templateUrl:"panel/home.html",controller:"PanelHomeController",data:{dependencies:["card.rtl.min.css"]}}).state("panel.history",{url:"/history",templateUrl:"panel/history.html",controller:"PanelHistoryController",data:{dependencies:["dropdown.min.js","dropdown.rtl.min.css"]}}).state("panel.post",{url:"/post",templateUrl:"panel/post.html",controller:"PanelPostController"}).state("panel.send",{url:"/send",templateUrl:"panel/send.html",controller:"PanelSendController",data:{dependencies:["progress.min.js","progress.rtl.min.css"]}}).state("panel.balance",{url:"/balance",templateUrl:"panel/balance.html",controller:"PanelBalanceController",data:{dependencies:["statistic.min.css"]}}).state("panel.account",{url:"/account",templateUrl:"panel/account.html",controller:"PanelAccountController",abstract:!0}).state("panel.account.summary",{url:"/summary",templateUrl:"panel/account/summary.html",controller:"PanelAccountSummaryController"}).state("panel.account.edit",{url:"/edit",templateUrl:"panel/account/edit.html",controller:"PanelAccountEditController"}).state("panel.account.password",{url:"/password",templateUrl:"panel/account/password.html",controller:"PanelAccountPasswordController"}).state("panel.account.confirm",{url:"/confirm",params:{action:null},templateUrl:"panel/account/confirm.html",controller:"PanelAccountConfirmController"}),e.state("admin",{url:"/admin",views:{"":{templateUrl:"admin.html",controller:"AdminController"},menu:{templateUrl:"admin/menu.html"},header:{templateUrl:"admin/header.html"}},abstract:!0,data:{dependencies:["loader.rtl.min.css","dropdown.min.js","dropdown.rtl.min.css"]}}).state("admin.home",{url:"/home",templateUrl:"admin/home.html",controller:"AdminHomeController",data:{dependencies:["dygraph.min.js","dygraph.min.css"]}}).state("admin.laboratory",{url:"/laboratory",templateUrl:"admin/laboratory.html",controller:"AdminLaboratoryController"}).state("admin.patient",{url:"/patient",templateUrl:"admin/patient.html",controller:"AdminPatientController"}).state("admin.sms",{url:"/sms",templateUrl:"admin/sms.html",controller:"AdminSmsController",data:{dependencies:["statistic.min.css"]}}),t.otherwise("/home/find"),r.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|sms|tg|tel):/)}]),app.run(["$rootScope","$state","$stateParams","$window","$timeout","Config","UserService","DynamicResourceLoader",function(e,t,n,r,o,a,i,s){angular.element("#ja-initial-loader-background").hide(),angular.element("#ja-initial-loader").hide(),angular.element("#ja-main-site-content").show(),angular.element("#ja-sidebar-menu").show(),s("icon-js-feeder.js",function(){o()}),0!==r.location.hash.indexOf("#/answer")&&t.go(localStorage.startState||"home.find"),e.$state=t,e.$stateParams=n,e.data={};var l=angular.element("head title");l.html(("live"===a.env?"":a.env+" - ")+l.html()),e.$on("$stateChangeStart",function(n,r,o,a,l,u){var c=r.name.split(".").map(function(e,n,r){var o=t.get(r.slice(0,n+1).join("."));return o.data&&o.data.dependencies}).filter(function(e){return!!e}).reduce(function(e,t){return e.concat(t)},[]),d=s(c,!0,function(){d&&t.go(r)});if(d)return void n.preventDefault();0===r.name.indexOf("panel.")?i.current()||(n.preventDefault(),t.go("lab.login")):(delete e.data.postCache,delete e.data.historyState,0===r.name.indexOf("admin.")?i.current()||(n.preventDefault(),t.go("lab.login")):i.current()&&i.logout())}),e.$on("$stateChangeSuccess",function(e,t,n,o,a){r.scrollTo(0,0)}),e.$on("$stateChangeError",function(e,t,n,r,o,a){})}]),app.factory("DynamicResourceLoader",["$timeout",function(e){function t(t,n,r){function o(){(n&&i||"function"==typeof r)&&e(function(){n&&i&&(angular.element("#ja-initial-loader-background").hide(),angular.element("#ja-initial-loader").hide(),angular.element("#ja-main-site-content").show(),angular.element("#ja-sidebar-menu").show()),"function"==typeof r&&r()})}var a=[].concat(t||[]).map(function(e){return"/dist/"+e}),i=0!==a.length;return n&&i&&(angular.element("#ja-initial-loader-background").show(),angular.element("#ja-initial-loader").show(),angular.element("#ja-main-site-content").hide(),angular.element("#ja-sidebar-menu").hide()),i?resourceLoader(a,o):(o(),0)}return t}]),app.factory("Utils",["$q","$http","$window",function(e,t,n){function r(e,t){return e.then(o(t),a)}function o(t){return function(n){return 200!=n.status?(console.log(n.status,n.data),e.reject(1)):0!==n.data.code?("function"==typeof t&&t(n.data),e.reject(n.data.code||1)):n.data}}function a(t){return console.error(t),e.reject(2)}return{httpPromiseHandler:r}}]),app.service("AdminService",["$q","$http","$window","Utils",function(e,t,n,r){function o(){return r.httpPromiseHandler(t.post("/admin/getNotSentSmses",{})).then(function(e){return(e.smsStateStatusList||[]).map(function(e){return e.data.timeStamp=new Date(e.data.timeStamp),e})})}function a(e){return r.httpPromiseHandler(t.post("/admin/tryAgainNotSentSms",{smsKey:e}))}function i(e){return r.httpPromiseHandler(t.post("/admin/checkNotSentSms",{smsKey:e}))}function s(){return r.httpPromiseHandler(t.post("/admin/getNotActivatedLabs",{})).then(function(e){return(e.inactiveLabs||[]).map(function(e){return e.timeStamp=new Date(e.timeStamp),e})})}function l(e){return e.timeStamp=e.timeStamp.getTime(),r.httpPromiseHandler(t.post("/admin/approveInactiveLab",{labData:e}))}function u(e){return r.httpPromiseHandler(t.post("/admin/declineInactiveLab",{labUsername:e}))}function c(){return r.httpPromiseHandler(t.post("/admin/getAllNewC2cPaymentReceipts",{})).then(function(e){return(e.c2cReceiptCodes||[]).map(function(e){return e.timeStamp=new Date(e.timeStamp),e})})}function d(e,n,o){return r.httpPromiseHandler(t.post("/admin/chargeLabFromC2c",{c2cReceiptId:e,labUsername:n,amount:o}))}function f(e){return r.httpPromiseHandler(t.post("/admin/declineC2cReceipt",{c2cReceiptId:e}))}function h(){return r.httpPromiseHandler(t.post("/admin/getNewFeedbacks",{})).then(function(e){return(e.feedbacks||[]).map(function(e){return e.timeStamp=new Date(e.timeStamp),e})})}function m(e){return r.httpPromiseHandler(t.post("/admin/checkFeedback",{feedbackId:e}))}function p(e,n){return r.httpPromiseHandler(t.post("/admin/respondFeedback",{feedbackId:e,message:n}))}function g(){return r.httpPromiseHandler(t.post("/admin/getAllLaboratories",{})).then(function(e){return(e.laboratories||[]).map(function(e){return e.timeStamp=new Date(e.timeStamp),e})})}function v(e,n){return r.httpPromiseHandler(t.post("/admin/editLaboratory",{labUsername:e,labData:n}))}function y(e){return r.httpPromiseHandler(t.post("/admin/removeLaboratory",{labUsername:e}))}function b(e,n){return r.httpPromiseHandler(t.post("/admin/sendDummySms",{phoneNumber:String(e),message:n}))}function w(){return r.httpPromiseHandler(t.post("/admin/findAllPhoneNumbers"))}function S(){return r.httpPromiseHandler(t.post("/admin/getNikSmsCredit")).then(function(e){return e.credit||0})}this.getNotSentSmses=o,this.tryAgainNotSentSms=a,this.checkNotSentSms=i,this.getNotActivatedLabs=s,this.approveInactiveLab=l,this.declineInactiveLab=u,this.getAllNewC2cPaymentReceipts=c,this.chargeLabFromC2c=d,this.declineC2cReceipt=f,this.getNewFeedbacks=h,this.checkFeedback=m,this.respondFeedback=p,this.getAllLaboratories=g,this.editLaboratory=v,this.removeLaboratory=y,this.sendDummySms=b,this.findAllPhoneNumbers=w,this.getNikSmsCredit=S}]),app.service("AnswerService",["$q","$http","$window","Utils",function(e,t,n,r){function o(e){return r.httpPromiseHandler(t.post("/answer/patient/info",{nationalCode:e})).then(function(e){return{fullName:e.fullName,numbers:e.numbers||[],email:e.email}})}function a(e,n,o,a){return r.httpPromiseHandler(t.post("/answer/send",{timeStamp:Date.now(),person:{nationalCode:e.nationalCode,fullName:e.fullName,mobilePhoneNumber:e.mobilePhoneNumber,phoneNumber:e.phoneNumber,extraPhoneNumber:e.extraPhoneNumber,email:e.email},files:n.map(function(e){return{serverName:e.serverName,name:e.name,size:e.size,type:e.type}}),notes:o}),function(e){a&&a(e.errors||{})})}this.patientInfo=o,this.send=a}]),app.service("BalanceService",["$q","$http","$window","Utils",function(e,t,n,r){function o(e,n){return r.httpPromiseHandler(t.post("/balance/submit/c2cReceiptCode",{c2cReceiptCode:e}),function(e){n&&n(e.errors||{})})}this.submitC2cReceiptCode=o}]),app.service("HistoryService",["$http","Utils",function(e,t){function n(n,r){return t.httpPromiseHandler(e.post("/history/generate/otp",{nationalCode:n,mobilePhoneNumber:r})).then(function(e){return{otpId:e.otpId,requestCode:e.requestCode}})}function r(n,r,o,a){return t.httpPromiseHandler(e.post("/history/find/history",{nationalCode:n,otpId:r,requestCode:o,otp:a})).then(function(e){return{patientInfo:e.patientInfo,history:e.history}})}function o(n,r){return t.httpPromiseHandler(e.post("/history/load/answer",{nationalCode:n,postCode:r})).then(function(e){return{patientName:e.patientName,postDate:new Date(e.timeStamp),notes:e.notes,files:e.files.map(function(e){return{serverName:e.serverName,name:e.name,size:e.size,type:e.type}}),lab:{name:e.lab.name,mobilePhoneNumber:e.lab.mobilePhoneNumber,phoneNumber:e.lab.phoneNumber,address:e.lab.address,postalCode:e.lab.postalCode,websiteAddress:e.lab.websiteAddress}}})}this.generateOtp=n,this.findHistory=r,this.loadAnswer=o}]),app.service("MasterService",["$q","$http","$window","Utils",function(e,t,n,r){function o(e,n,o){return r.httpPromiseHandler(t.post("/master/send/feedback",{mobilePhoneNumber:e,message:n}),function(e){o&&o(e.errors||{})})}this.sendFeedback=o}]),app.service("PostService",["$q","$http","Utils",function(e,t,n){function r(e,r){return n.httpPromiseHandler(t.post("/post/load/all",{year:e,months:r})).then(function(e){var t=e.postPacks||{};for(var n in t){var r=t[n]||"",o=r.split("|").filter(function(e){return!!e}).map(function(e){return{nationalCode:e.slice(0,10),filesCount:Number(e.slice(10,12)),postCode:e.slice(12,16),postDate:new Date(Number(e.slice(16,29)))}});t[n]=o}return t})}function o(e,r){return n.httpPromiseHandler(t.post("/post/load/one",{nationalCode:e,postCode:r})).then(function(e){return{fullName:e.fullName,nationalCode:e.nationalCode,numbers:e.numbers||[],email:e.email,postCode:e.postCode,postDate:new Date(e.timeStamp),notes:e.notes,files:e.files||[]}})}this.getPosts=r,this.getOnePost=o}]),app.service("UserService",["$q","$http","$window","Utils",function(e,t,n,r){function o(e,n){return r.httpPromiseHandler(t.post("/user/register",{userData:{labName:e.labName,mobilePhoneNumber:e.mobilePhoneNumber,phoneNumber:e.phoneNumber,address:e.address,postalCode:e.postalCode,websiteAddress:e.websiteAddress,username:e.username,password:e.password},recaptcha:e.response}),function(e){n&&n(e.errors||{})})}function a(e,n){return r.httpPromiseHandler(t.post("/user/register/confirm",{username:e,validationCode:n}))}function i(e,n){return r.httpPromiseHandler(t.post("/user/edit/account",{newAccount:{labName:e.labName,mobilePhoneNumber:e.mobilePhoneNumber,phoneNumber:e.phoneNumber,address:e.address,postalCode:e.postalCode,websiteAddress:e.websiteAddress}}),function(e){n&&n(e.errors||{})})}function s(e,n,o){return r.httpPromiseHandler(t.post("/user/edit/password",{oldPassword:e,newPassword:n}),function(e){o&&o(e.errors||{})})}function l(e,n){return r.httpPromiseHandler(t.post("/user/edit/confirm",{username:e,validationCode:n})).then(function(e){var t=p(e.userInfo);return m(void 0,t),t})}function u(e,n){return r.httpPromiseHandler(t.post("/user/login",{username:e,password:n})).then(function(e){var n=e.accessKey,r=p(e.userInfo);return t.defaults.headers.common["X-Access-Token"]=n,m(n,r),r})}function c(){return null===f()?e.reject(50):r.httpPromiseHandler(t.post("/user/refresh",{})).then(function(e){var t=p(e.userInfo);return m(void 0,t),t})}function d(){return delete t.defaults.headers.common["X-Access-Token"],delete n.sessionStorage.CurrentUser,e.when()}function f(){try{var e=n.sessionStorage.CurrentUser;if(!e)return null;var t=JSON.parse(e);if(!t)return null;var r=p(t.userInfo);return r||null}catch(e){return null}}function h(e,n){return r.httpPromiseHandler(t.post("/user/restorePassword",{username:e,mobilePhoneNumber:n}))}function m(e,t){var r;try{r=JSON.parse(n.sessionStorage.CurrentUser||"{}")||{}}catch(e){r={}}void 0!==e&&(r.accessKey=e),void 0!==t&&(r.userInfo=t),n.sessionStorage.CurrentUser=JSON.stringify(r)}function p(e){return e&&(e.subscriptionDate=new Date(e.timeStamp)),e}this.register=o,this.registerConfirm=a,this.editAccount=i,this.editPassword=s,this.editConfirm=l,this.login=u,this.refresh=c,this.logout=d,this.current=f,this.restorePassword=h}]),app.controller("AdminHomeController",["$scope","$rootScope","$state","$stateParams","$timeout","UserService","AdminService",function(e,t,n,r,o,a,i){var s=a.current();e.setPageTitle(s&&s.fullName||" "),e.setBackHandler(e.menuHandlers.logout),e.submenus=["صفحه اصلی","پیامک های ارسال نشده","درخواست های عضویت جدید","رسیدهای ثبت شده پرداخت کارت به کارت","بازخوردهای صفحه تماس با ما","آمار و نمودارهای وبسایت"],e.selectedSubmenu=0,e.selectedSubmenuText=e.submenus[0],$("#ja-admin-home-submenu-selector").dropdown({onChange:function(t,n){o(function(){e.selectedSubmenu=t,e.selectedSubmenuText=n})}}).dropdown("set selected",0)}]),app.controller("AdminLaboratoryController",["$scope","$rootScope","$state","$stateParams","UserService","AdminService",function(e,t,n,r,o,a){function i(t){e.selectedLab=t,e.selectedLabIndex=e.laboratories.indexOf(t),e.editingLab=angular.copy(t),e.updating=!1,u=$("#ja-admin-laboratory-edit-modal").modal({closable:!1,onApprove:function(){return e.updating=!0,a.editLaboratory(t.username,e.editingLab).then(function(){e.laboratories[e.selectedLabIndex]=e.editingLab,e.selectedLab=e.editingLab,u.modal("hide")},function(t){e.updating=!1,alert(t)}),!1},onDeny:function(){}}).modal("show")}function s(){var t=Number(e.charge||"");t&&(e.editingLab.balance=Number(e.editingLab.balance)+t,e.charge="")}function l(){if(e.labNameAgain!==e.editingLab.labName)return void alert("نام را اشتباه وارد کرده اید.\nلطفاً از این که می خواهید این آزمایشگاه را حذف کنید مطمئن شوید.");e.updating=!0,a.removeLaboratory(e.editingLab.username).then(function(){e.laboratories.splice(e.selectedLabIndex,1),e.selectedLab=null,e.selectedLabIndex=-1,u.modal("hide")},function(t){e.updating=!1,alert(t)})}e.setPageTitle("آزمایشگاه ها"),e.setBackHandler(e.menuHandlers.goToMainPage),e.selectLab=i,e.chargeLab=s,e.removeLab=l,e.laboratories=[],e.selectedLab=null,e.setLoading(!0),a.getAllLaboratories().then(function(t){e.laboratories=t,e.setLoading(!1)},function(t){alert(t),e.setLoading(!1)});var u}]),app.controller("AdminPatientController",["$scope","$rootScope","$state","$stateParams","UserService","AdminService",function(e,t,n,r,o,a){e.setPageTitle("بیمارها"),e.setBackHandler(e.menuHandlers.goToMainPage)}]),app.controller("AdminSmsController",["$scope","$rootScope","$state","$timeout","$stateParams","UserService","AdminService",function(e,t,n,r,o,a,i){function s(){e.waiting=!0,i.sendDummySms(e.phoneNumber,e.message).catch(function(e){alert(e)}).then(function(){e.waiting=!1})}function l(){e.waiting=!0,i.findAllPhoneNumbers().then(function(){e.areAllPhoneNumbersReady=!0},function(e){alert(e)}).then(function(){e.waiting=!1})}function u(){e.waiting=!0,i.getNikSmsCredit().then(function(t){e.credit=t},function(e){alert(e)}).then(function(){e.waiting=!1})}e.setPageTitle("پیامک ها"),e.setBackHandler(e.menuHandlers.goToMainPage),e.submenus=["ارسال پیامک آزمایشی","فهرست تمام شماره تلفن های استفاده شده","شارژ باقیمانده نیک اِس اِم اِس"],e.selectedSubmenu=0,e.selectedSubmenuText=e.submenus[0],$("#ja-admin-sms-submenu-selector").dropdown({onChange:function(t,n){r(function(){e.selectedSubmenu=t,e.selectedSubmenuText=n,2==e.selectedSubmenu&&u()})}}).dropdown("set selected",0),e.waiting=!1,e.sendDummySms=s,e.findAllPhoneNumbers=l,e.message="سامانه اینترنتی جواب آزمایش\nJavabAzmayesh.ir",e.areAllPhoneNumbersReady=!1}]),app.controller("CommonAboutController",["$scope","$state","$stateParams",function(e,t,n){e.previousState=n.previousState,e.setBackHandler(function(){t.go(e.previousState)})}]),app.controller("CommonContactController",["$scope","$state","$stateParams","MasterService",function(e,t,n,r){function o(){e.vs.validate()&&(e.sendingFeedback=!0,r.sendFeedback(e.mobilePhoneNumber,e.message,e.vs.dictate).then(function(){e.sendingFeedback=!1,e.showMessage("ارسال موفقیت آمیز پیام","از همکاری شما صمیمانه متشکریم.\nپیام شما با موفقیت در سامانه ثبت گردید.\nاین پیام در اسرع وقت مورد بررسی قرار خواهد گرفت.").then(function(){delete e.message})},function(t){e.sendingFeedback=!1,alert(t)}))}e.sendFeedback=o,e.sendingFeedback=!1,e.previousState=n.previousState,e.setBackHandler(function(){t.go(e.previousState)}),e.vs=new ValidationSystem(e).field("mobilePhoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.mobilePhoneNumber()]).field("message",[ValidationSystem.validators.notEmpty()])}]),app.controller("HomeFindController",["$rootScope","$scope","$state","$timeout",function(e,t,n,r){function o(){t.vs.validate()&&n.go("answer",{p:t.nationalCode,n:t.postCode,previousState:"home.find",previousStateData:null})}t.seeAnswer=o,t.findingAnswer=!1,localStorage.startState="home.find",t.setBackHandler(!1),t.vs=new ValidationSystem(t).field("nationalCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.nationalCode()]).field("postCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.numberCode(4)])}]),app.controller("HomeHistoryController",["$rootScope","$scope","$state","$stateParams","$timeout","HistoryService",function(e,t,n,r,o,a){function i(){t.vs.validate()&&(t.findingHistory=!0,a.findHistory(t.nationalCode,s,l,t.otp).then(function(r){e.data.patientInfo=r.patientInfo,e.data.history=r.history,n.go("history",{nationalCode:t.nationalCode})},function(e){t.findingHistory=!1,alert(e)}))}t.findHistory=i,t.nationalCode=r.nationalCode;var s=r.otpId,l=r.requestCode;t.findingHistory=!1,t.setBackHandler(function(){n.go("home.otp")}),t.vs=new ValidationSystem(t).field("otp",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.numberCode(6)])}]),app.controller("HomeOtpController",["$rootScope","$scope","$state","$timeout","HistoryService",function(e,t,n,r,o){function a(){t.vs.validate()&&(t.sendingOtp=!0,o.generateOtp(t.nationalCode,t.mobilePhoneNumber).then(function(e){n.go("home.history",{nationalCode:t.nationalCode,otpId:e.otpId,requestCode:e.requestCode})},function(e){t.sendingOtp=!1,alert(e)}))}t.sendOtp=a,t.sendingOtp=!1,t.setBackHandler(function(){n.go("home.find")}),t.vs=new ValidationSystem(t).field("nationalCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.nationalCode()]).field("mobilePhoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.mobilePhoneNumber()])}]),app.controller("LabForgetController",["$rootScope","$scope","$state","$timeout","UserService",function(e,t,n,r,o){function a(){if(t.vs.validate())return t.restoringPassword=!0,o.restorePassword(t.username,t.mobilePhoneNumber).then(function(){n.go("lab.password")},function(e){t.restoringPassword=!1,alert(e)})}t.restorePassword=a,t.restoringPassword=!1,t.setBackHandler(function(){n.go("lab.login")}),t.vs=new ValidationSystem(t).field("username",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.username(),ValidationSystem.validators.minLength(4)]).field("mobilePhoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.mobilePhoneNumber()])}]),app.controller("LabLoginController",["$rootScope","$scope","$state","UserService",function(e,t,n,r){function o(){if(t.vs.validate())return t.loggingIn=!0,r.login(t.username,t.password).then(function(t){"laboratory"===t.userType?(e.data.labData=t,n.go("panel.home")):"administrator"===t.userType&&(e.data.adminData=t,n.go("admin.home"))},function(e){t.loggingIn=!1,alert(e)})}t.login=o,t.loggingIn=!1,localStorage.startState="lab.login",t.setBackHandler(!1),t.vs=new ValidationSystem(t).field("username",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.username(),ValidationSystem.validators.minLength(4)]).field("password",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(4)])}]),app.controller("LabRegisterController",["$rootScope","$scope","$state","$stateParams","$timeout","vcRecaptchaService","UserService","Config",function(e,t,n,r,o,a,i,s){function l(e){t.response=e}function u(e){t.widgetId=e}function c(){s.google_recaptcha&&a.reload(t.widgetId),t.response=null}function d(){if(t.vs.validate())return t.sendingRegisterationForm=!0,s.google_recaptcha&&(t.model.response=t.response),i.register(t.model,t.vs.dictate).then(function(){n.go("lab.validate",{username:t.model.username})},function(e){t.sendingRegisterationForm=!1,alert(e),s.google_recaptcha&&a.reload(t.widgetId)})}t.setResponse=l,t.setWidgetId=u,t.cbExpiration=c,t.sendRegisterationForm=d,t.showGoogleRecaptcha=s.google_recaptcha,t.key=s.google_recaptcha_public_key,t.sendingRegisterationForm=!1,t.model={},t.model.username=r.username,t.setBackHandler(function(){n.go("lab.login")}),t.vs=new ValidationSystem(t.model).field("labName",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(5)]).field("mobilePhoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.mobilePhoneNumber()]).field("phoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.phoneNumber()]).field("address",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(10)]).field("postalCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.integer(),ValidationSystem.validators.length(10)]).field("websiteAddress",[ValidationSystem.validators.notRequired(),ValidationSystem.validators.minLength(5),ValidationSystem.validators.url()]).field("username",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.username(),ValidationSystem.validators.minLength(4)]).field("password",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(4),function(e){if(t.model.passwordAgain&&t.model.passwordAgain!=e)return"کلمه های عبور وارد شده یکسان نیستند"}]).field("passwordAgain",[function(e){if(!t.model.password)return!0},ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(4),function(e){if(t.model.password!=e)return"کلمه های عبور وارد شده یکسان نیستند"}]).field("acceptRules",[ValidationSystem.validators.notEmpty("پذیرفتن قوانین و مقررات الزامی است")])}]),app.controller("LabValidateController",["$rootScope","$scope","$state","$stateParams","UserService",function(e,t,n,r,o){function a(){if(t.vs.validate())return t.confirmingRegisteration=!0,o.registerConfirm(t.username,t.validationCode).then(function(){t.confirmingRegisteration=!1,n.go("lab.signedup")},function(e){t.confirmingRegisteration=!1,alert(e)})}t.confirmRegisteration=a,t.username=r.username,t.confirmingRegisteration=!1,t.setBackHandler(function(){n.go("lab.register",{username:t.username})}),t.vs=new ValidationSystem(t).field("validationCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.numberCode(4)])}]),app.controller("PanelAccountController",["$scope","$rootScope","$state","$stateParams",function(e,t,n,r){}]),app.controller("PanelBalanceController",["$scope","$rootScope","$state","$stateParams","$timeout","Config","BalanceService",function(e,t,n,r,o,a,i){function s(){e.vs.validate("c2cReceiptCode")&&(e.preparingPayment=!0,i.submitC2cReceiptCode(e.c2cReceiptCode,e.vs.dictate).then(function(){e.preparingPayment=!1,e.showMessage("درخواست شما ثبت شد","درخواست شما در اسرع وقت مورد بررسی قرار خواهد گرفت و حساب شما شارژ خواهد شد.").then(function(){n.go("panel.home")})},function(t){e.preparingPayment=!1,alert(t)}))}function l(){}e.c2cPayment=s,e.zpPayment=l,e.balance=t.data.labData.balance||0,e.preparingPayment=!1,e.setBackHandler(function(){n.go("panel.home")}),e.setPageTitle("وضعیت حساب و تأمین اعتبار"),e.vs=new ValidationSystem(e).field("c2cReceiptCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(4),ValidationSystem.validators.integer()]).field("zpChargeAmount",[]),e.testCount=Math.floor(e.balance/a.post_price),e.balanceForDisplay=toPersianNumber(e.balance),e.testCountForDisplay=e.testCount>0?toPersianNumber(e.testCount):"–",e.testCount>=200?e.balanceColor="green":e.testCount>=50?e.balanceColor="olive":e.testCount>=20?e.balanceColor="yellow":e.testCount>0?e.balanceColor="orange":e.balanceColor="red"}]),app.controller("PanelHistoryController",["$scope","$rootScope","$state","$stateParams","$timeout","$window","UserService","PostService",function(e,t,n,r,o,a,i,s){function l(e){g.scrollY=a.scrollY}function u(t){e.setLoading(!0);var n=v[e.selectedYear]=v[e.selectedYear]||[],r=Array.range(e.selectedMonthFrom,e.selectedMonthTo),o=r.filter(function(e){return!n[e]});t&&e.selectedYear==m&&r.indexOf(p)>=0&&o.indexOf(p)<0&&o.push(p);var a;return a=Object.keys(o).length?s.getPosts(e.selectedYear,o).catch(function(e){alert(e)}):Promise.resolve({}),a.then(function(t){e.posts=[];for(var o=12;o>=1;o--)r.indexOf(o)>=0&&(n[o]=t[e.selectedYear+"/"+o]||n[o]||[],e.posts=e.posts.concat(n[o]))}).then(function(){e.setLoading(!1)})}function c(e){t.data.post=e,n.go("panel.post")}e.postClicked=c,e.maxCount=500;var d=i.current(),f=d.subscriptionDate.jYMD()[0],h=(new Date).jYMD(),m=h[0],p=h[1];e.allYears=Array.range(m,f),e.persianMonths=["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"];var g=t.data.historyState=t.data.historyState||{};e.nationalCode=g.nationalCode,e.selectedYear=g.selectedYear||e.allYears[0],e.selectedMonthFrom=g.selectedMonthFrom||p,
e.selectedMonthFromText=e.persianMonths[e.selectedMonthFrom-1],e.selectedMonthTo=g.selectedMonthTo||p,e.selectedMonthToText=e.persianMonths[e.selectedMonthTo-1];var v=t.data.postCache=t.data.postCache||[];e.posts=[],u(!0).then(function(){o(function(){a.scrollTo(a.scrollX,g.scrollY)})}),e.$watch("nationalCode",function(){g.nationalCode=e.nationalCode}),a.addEventListener("scroll",l),e.$on("$destroy",function(){a.removeEventListener("scroll",l)}),e.setBackHandler(function(){n.go("panel.home")}),e.setPageTitle("سوابق نتایج ثبت شده"),angular.element("#select-year").dropdown({onChange:function(t,n){e.selectedYear=g.selectedYear=t,u()}}),angular.element("#select-month-from").dropdown({onChange:function(t,n){t=Number(t),e.selectedMonthFrom=g.selectedMonthFrom=t,e.selectedMonthFromText=e.persianMonths[t-1];var r=e.selectedMonthTo>e.selectedMonthFrom?e.selectedMonthTo:e.selectedMonthFrom;r!=e.selectedMonthTo&&angular.element("#select-month-to").dropdown("set selected",e.selectedMonthTo=g.selectedMonthTo=r),u()}}),angular.element("#select-month-to").dropdown({onChange:function(t,n){t=Number(t),e.selectedMonthTo=g.selectedMonthTo=t,e.selectedMonthToText=e.persianMonths[t-1];var r=e.selectedMonthFrom<e.selectedMonthTo?e.selectedMonthFrom:e.selectedMonthTo;r!=e.selectedMonthFrom&&angular.element("#select-month-from").dropdown("set selected",e.selectedMonthFrom=g.selectedMonthFrom=r),u()}})}]),app.controller("PanelHomeController",["$scope","$rootScope","$state","$stateParams","UserService",function(e,t,n,r,o){e.setBackHandler(e.menuHandlers.logout);var a=o.current();e.setPageTitle(a&&a.labName||" ")}]),app.controller("PanelPostController",["$scope","$rootScope","$state","$stateParams","PostService",function(e,t,n,r,o){var a=t.data.post;e.setBackHandler(function(){n.go("panel.history")}),e.setPageTitle("لطفاً کمی صبر کنید..."),e.setLoading(!0),o.getOnePost(a.nationalCode,a.postCode).then(function(t){e.post=t,e.setPageTitle(e.post.fullName),e.postDataForDisplay=[{label:"نام بیمار",value:toPersianNumber(t.fullName)},{label:"کد ملی بیمار",value:toPersianNumber(t.nationalCode)},{label:"تلفن های تماس بیمار",value:toPersianNumber(t.numbers.join(" - "))},{label:"آدرس پست الکترونیکی بیمار",value:t.email},{label:"شماره آزمایش",value:toPersianNumber(t.postCode)},{label:"تاریخ ارسال نتایج آزمایش",value:persianDate(t.postDate).format("L")},{label:"تعداد فایل های پیوست",value:toPersianNumber(t.files.length)}]},function(e){alert(e)}).then(function(){e.setLoading(!1)})}]),app.controller("PanelSendController",["$scope","$rootScope","$state","$stateParams","$window","$timeout","$http","AnswerService",function(e,t,n,r,o,a,i,s){function l(){if(e.vs.see("nationalCode")&&!(e.person.fullName&&e.person.mobilePhoneNumber&&e.person.phoneNumber&&e.person.extraPhoneNumber&&e.person.email))return e.sendingAnswer=!0,s.patientInfo(e.person.nationalCode).then(function(t){e.person.fullName=e.person.fullName||t.fullName,e.person.mobilePhoneNumber=e.person.mobilePhoneNumber||t.numbers[0],e.person.phoneNumber=e.person.phoneNumber||t.numbers[1],e.person.extraPhoneNumber=e.person.extraPhoneNumber||t.numbers[2],e.person.email=e.person.email||t.email,e.vs.check("fullName","mobilePhoneNumber","phoneNumber","extraPhoneNumber","email")},function(e){}).then(function(){e.sendingAnswer=!1})}function u(){e.vs.validate()&&(e.sendingAnswer=!0,s.send(e.person,e.files,e.notes,e.vs.dictate).then(function(){return e.refreshUserData()}).then(function(){e.sendingAnswer=!1,e.showMessage("ارسال موفقیت آمیز نتایج آزمایش","نتایج آزمایش ثبت شده و اطلاع رسانی لازم به بیمار صورت خواهد گرفت.").then(function(){n.go("panel.home")})},function(t){e.sendingAnswer=!1,alert(t)}))}function c(){S.click()}function d(e){var t=w(S.files);S.value="",g(t)}function f(e){C.className="dragover"===e.type&&e.path.indexOf(C)>=0?"drag-on":"",e.stopPropagation(),e.preventDefault()}function h(e){f(e)}function m(e){f(e)}function p(e){if(f(e),e.path.indexOf(C)>=0){g(w(e.target.files||e.dataTransfer.files))}}function g(t){t=t.filter(function(t){return t.size>0&&t.size<=10485760&&""!=t.type&&0===e.files.filter(function(e){return e.name===t.name&&e.size===t.size&&e.type===t.type&&e.lastModified===t.lastModified}).length}),t.forEach(function(e){if(e.id=M++,e.srcPreview=iconJs.file(e.name),e.type.match("image.*")){var t=new FileReader;t.onload=function(t){a(function(){e.srcPreview=t.target.result})},t.readAsDataURL(e)}}),t.forEach(v),e.files=e.files.concat(t),e.$$phase||e.$apply()}function v(t){t.status="Preparing";var n=new FormData;n.append(t.name,t);var r=new XMLHttpRequest;t.xhr=r,r.open("post","/answer/file/upload",!0),r.setRequestHeader("X-Access-Token",i.defaults.headers.common["X-Access-Token"]),r.upload.onprogress=function(n){n.lengthComputable&&(t.progress=Math.floor(n.loaded/n.total*100),angular.element("#progress-"+t.id).progress({percent:t.progress}),e.$$phase||e.$apply())},r.onerror=function(n){t.status="Error",e.$$phase||e.$apply()},r.onabort=function(n){"Aborting"===t.status&&(t.status="Aborted"),e.$$phase||e.$apply()},r.onload=function(n){try{if(200!=n.currentTarget.status)throw n.currentTarget.response;t.serverName=JSON.parse(n.currentTarget.response).filename,t.status="Uploaded"}catch(e){t.status="Error"}e.$$phase||e.$apply()},t.status="Uploading",t.progress=0,angular.element("#progress-"+t.id).progress({percent:t.progress}),e.$$phase||e.$apply(),r.send(n)}function y(e){e.status="Aborting",e.xhr.abort()}function b(t){y(t),t.status="Removing",a(function(){t.status="Removed",e.files.splice(e.files.indexOf(t),1)})}function w(e){return Array.apply(null,{length:e.length}).map(Number.call,Number).map(function(t){return e[t]})}e.loadPatientInfo=l,e.sendAnswer=u,e.selectFilesDialog=c,e.abortUpload=y,e.removeFile=b,e.sendingAnswer=!1,e.files=[],e.setBackHandler(function(){n.go("panel.home")}),e.setPageTitle("ارسال نتایج");var S=o.document.getElementById("input-file"),C=o.document.getElementById("drop-zone");S.addEventListener("change",d,!1),o.document.addEventListener("dragover",h,!1),o.document.addEventListener("dragleave",m,!1),o.document.addEventListener("drop",p,!1),e.$on("$destroy",function(){S.removeEventListener("change",d),o.document.removeEventListener("dragover",h),o.document.removeEventListener("dragleave",m),o.document.removeEventListener("drop",p)}),e.person={},e.vs=new ValidationSystem(e.person).field("nationalCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.nationalCode()]).field("fullName",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(3)]).field("mobilePhoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.mobilePhoneNumber()]).field("phoneNumber",[ValidationSystem.validators.notRequired(),ValidationSystem.validators.phoneNumber()]).field("extraPhoneNumber",[ValidationSystem.validators.notRequired(),ValidationSystem.validators.phoneNumber()]).field("email",[ValidationSystem.validators.notRequired(),ValidationSystem.validators.email()]);var M=0}]),app.controller("AdminHomeNewC2cPaymentCodesController",["$scope","$rootScope","$state","$stateParams","AdminService",function(e,t,n,r,o){function a(){e.setLoading(!0),o.getAllNewC2cPaymentReceipts().then(function(t){e.c2cPaymentCodes=t},function(e){alert(e)}).then(function(){e.setLoading(!1)})}function i(t,n){null===e.selectedC2c?(delete e.selectedC2c,delete e.selectedC2cIndex):e.selectedC2cIndex!==n&&(e.selectedC2c=t,e.selectedC2cIndex=n)}function s(){e.selectedC2c=null,e.selectedC2cIndex=null}function l(t){var n=Number(t||"");n&&(e.updating=!0,o.chargeLabFromC2c(e.selectedC2c.id,e.selectedC2c.username,n).then(function(){e.c2cPaymentCodes.splice(e.selectedC2cIndex,1),delete e.selectedC2c,delete e.selectedC2cIndex},function(e){alert(e)}).then(function(){e.updating=!1}))}function u(){e.showConfirmMessage("حذف کد رهگیری ثبت شده","شما در شُرُف حذف و نا دیده گرفتن شماره رهگیری پرداخت ثبت شده توسط کاربر هستید.\nآیا از این کار اطمینان دارید؟","بله، حذف شود","نه، حذف نشود","red","basic green").then(function(){e.updating=!0,o.declineC2cReceipt(e.selectedC2c.id).then(function(){e.c2cPaymentCodes.splice(e.selectedC2cIndex,1),delete e.selectedC2c,delete e.selectedC2cIndex},function(e){alert(e)}).then(function(){e.updating=!1})})}e.getAllNewC2cPaymentReceipts=a,e.openC2c=i,e.closeSelectedC2c=s,e.chargeLab=l,e.declineC2c=u,a()}]),app.controller("AdminHomeNewFeedbacksController",["$scope","$rootScope","$state","$stateParams","AdminService",function(e,t,n,r,o){function a(){e.setLoading(!0),o.getNewFeedbacks().then(function(t){e.feedbacks=t},function(e){alert(e)}).then(function(){e.setLoading(!1)})}function i(t,n){null===e.selectedFb?(delete e.selectedFb,delete e.selectedFbIndex):e.selectedFbIndex!==n&&(e.selectedFb=t,e.selectedFbIndex=n,e.respondMessage="سلام!\nبازخورد شما بررسی شد.\nبا سپاس فراوان از این که ما را با بازخوردهای خود یاری می کنید.")}function s(){e.selectedFb=null,e.selectedFbIndex=null}function l(){e.showConfirmMessage("حذف بازخورد ثیت شده کاربر","پس از تأیید، بازخورد مورد نظر از سامانه حذف می شود.\nآیا این بازخورد را مطالعه و بررسی کرده و پاسخ مناسب را به کاربر داده اید؟","بله، حذف شود","نه، حذف نشود","orange","basic green").then(function(){e.updating=!0,o.checkFeedback(e.selectedFb.id).then(function(){e.feedbacks.splice(e.selectedFbIndex,1),delete e.selectedFb,delete e.selectedFbIndex},function(e){alert(e)}).then(function(){e.updating=!1})})}function u(){e.updating=!0,o.respondFeedback(e.selectedFb.id,e.respondMessage).then(function(){e.feedbacks.splice(e.selectedFbIndex,1),delete e.selectedFb,delete e.selectedFbIndex},function(e){alert(e)}).then(function(){e.updating=!1})}e.getNewFeedbacks=a,e.openFb=i,e.closeSelectedFb=s,e.checkFb=l,e.respondFb=u,a()}]),app.controller("AdminHomeNotActivatedLabsController",["$scope","$rootScope","$state","$stateParams","AdminService",function(e,t,n,r,o){function a(){e.setLoading(!0),o.getNotActivatedLabs().then(function(t){e.inactiveLabs=t},function(e){alert(e)}).then(function(){e.setLoading(!1)})}function i(t,n){null===e.selectedLab?(delete e.selectedLab,delete e.selectedLabIndex):e.selectedLabIndex!==n&&(e.selectedLab=angular.copy(t),e.selectedLabIndex=n)}function s(){e.selectedLab=null,e.selectedLabIndex=null}function l(){e.showConfirmMessage("تأیید کاربر جدید","آیا از تأیید کاربر جدید مطمئن هستید؟","بله، تأیید شود","خیر","green","basic gray").then(function(){e.updating=!0,o.approveInactiveLab(e.selectedLab).then(function(){e.inactiveLabs.splice(e.selectedLabIndex,1),delete e.selectedLab,delete e.selectedLabIndex},function(e){alert(e)}).then(function(){e.updating=!1})})}function u(){e.showConfirmMessage("تأییدیه برای حذف کاربر جدید","آیا از تصمیم خود مبنی بر حذف کامل کاربر جدید مطمئن هستید؟\n در صورت حذف، امکان بازگشت وجود ندارد.","بله، حذف شود","نه، حذف نشود","red","basic green").then(function(){e.updating=!0,o.declineInactiveLab(e.selectedLab.username).then(function(){e.inactiveLabs.splice(e.selectedLabIndex,1),delete e.selectedLab,delete e.selectedLabIndex},function(e){alert(e)}).then(function(){e.updating=!1})})}e.getNotActivatedLabs=a,e.openLab=i,e.closeSelectedLab=s,e.approveLab=l,e.declineLab=u,a()}]),app.controller("AdminHomeNotDeliveredSmsesController",["$scope","$rootScope","$state","$stateParams","AdminService",function(e,t,n,r,o){function a(){e.setLoading(!0),o.getNotSentSmses().then(function(t){e.notDeliveredSmses=t},function(e){alert(e)}).then(function(){e.setLoading(!1)})}function i(t,n){null===e.selectedSms?(delete e.selectedSms,delete e.selectedSmsIndex):(e.selectedSms=t,e.selectedSmsIndex=n)}function s(){e.selectedSms=null,e.selectedSmsIndex=null}function l(){e.updating=!0,o.tryAgainNotSentSms(e.selectedSms.data.smsKey).then(function(){e.notDeliveredSmses.splice(e.selectedSmsIndex,1),delete e.selectedSms,delete e.selectedSmsIndex},function(e){alert(e)}).then(function(){e.updating=!1})}function u(){e.updating=!0,o.checkNotSentSms(e.selectedSms.data.smsKey).then(function(){e.notDeliveredSmses.splice(e.selectedSmsIndex,1),delete e.selectedSms,delete e.selectedSmsIndex},function(e){alert(e)}).then(function(){e.updating=!1})}function c(e,t){return"sms:"+e+";?&"+simpleQueryString.stringify({body:t})}function d(){h.message||(h.message=new Clipboard("#ja-copy-message"),h.message.on("success",function(e){console.info("Success",e.action,e.text),e.clearSelection()}),h.message.on("error",function(e){console.info("Error",e.action,e.text)}))}function f(e){e=String(e),h[e]||(h[e]=new Clipboard("#ja-copy-number-"+e),h[e].on("success",function(e){console.info("Success",e.action,e.text),e.clearSelection()}),h[e].on("error",function(e){console.info("Error",e.action,e.text)}))}e.getNotSentSmses=a,e.openSms=i,e.closeSelectedSms=s,e.sendSmsAgain=l,e.checkSelectedSms=u,e.makeSmsHref=c,e.copyMessage=d,e.copyNumber=f;var h={};a()}]),app.controller("PanelAccountConfirmController",["$scope","$rootScope","$state","$stateParams","$timeout","UserService",function(e,t,n,r,o,a){function i(){e.vs.validate()&&(e.confirming=!0,a.editConfirm(t.data.labData.username,e.verificationCode).then(function(){e.confirming=!1,e.showMessage("عملیات با موفقیت انجام شد","change password"===e.action?"رمز عبور شما با موفقیت تغییر کرد":"edit account"===e.action?"اصلاحات مورد نظر با موفقیت در سامانه ثبت شدند":"").then(function(){return e.refreshUserData()}).then(function(){n.go("panel.account.summary")})},function(t){e.confirming=!1,alert(t)}))}e.confirm=i,e.confirming=!1,e.action=r.action,e.setBackHandler(function(){"change password"===e.action?n.go("panel.account.password"):"edit account"===e.action?n.go("panel.account.edit"):n.go("panel.account.summary")}),e.setPageTitle("تأیید عملیات"),e.vs=new ValidationSystem(e).field("verificationCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.numberCode(4)])}]),app.controller("PanelAccountEditController",["$scope","$rootScope","$state","$stateParams","$timeout","UserService",function(e,t,n,r,o,a){function i(){e.vs.validate()&&(e.editingAccount=!0,a.editAccount(e.user,e.vs.dictate).then(function(){n.go("panel.account.confirm",{action:"edit account"}),e.editingAccount=!1},function(t){e.editingAccount=!1,alert(t)}))}e.editAccount=i,e.editingAccount=!1,e.user={labName:t.data.labData.labName,mobilePhoneNumber:t.data.labData.mobilePhoneNumber,phoneNumber:t.data.labData.phoneNumber,address:t.data.labData.address,postalCode:t.data.labData.postalCode,websiteAddress:t.data.labData.websiteAddress},e.setBackHandler(function(){n.go("panel.account.summary")}),e.setPageTitle("ویرایش اطلاعات کاربری آزمایشگاه"),e.vs=new ValidationSystem(e.user).field("labName",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(5)]).field("mobilePhoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.mobilePhoneNumber()]).field("phoneNumber",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.phoneNumber()]).field("address",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(10)]).field("postalCode",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.integer(),ValidationSystem.validators.length(10)]).field("websiteAddress",[ValidationSystem.validators.notRequired(),ValidationSystem.validators.minLength(5),ValidationSystem.validators.url()])}]),app.controller("PanelAccountPasswordController",["$scope","$rootScope","$state","$stateParams","$timeout","UserService",function(e,t,n,r,o,a){function i(){e.vs.validate()&&(e.changingPassword=!0,a.editPassword(e.oldPassword,e.newPassword,e.vs.dictate).then(function(){n.go("panel.account.confirm",{action:"change password"}),e.changingPassword=!1},function(t){e.changingPassword=!1,alert(t)}))}e.changePassword=i,e.changingPassword=!1,e.setBackHandler(function(){n.go("panel.account.summary")}),e.setPageTitle("تغییر کلمه عبور"),e.vs=new ValidationSystem(e).field("oldPassword",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(4)]).field("newPassword",[ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(4),function(t){if(e.newPasswordAgain&&e.newPasswordAgain!=t)return"کلمه های عبور وارد شده یکسان نیستند"}]).field("newPasswordAgain",[function(t){if(!e.newPassword)return!0},ValidationSystem.validators.notEmpty(),ValidationSystem.validators.minLength(4),function(t){if(e.newPassword!=t)return"کلمه های عبور وارد شده یکسان نیستند"}])}]),app.controller("PanelAccountSummaryController",["$scope","$rootScope","$state","$stateParams","$timeout",function(e,t,n,r,o){function a(){n.go("panel.account.edit")}function i(){n.go("panel.account.password")}e.editAccountData=a,e.changePassword=i,e.userDataForDisplay=[{label:"نام آزمایشگاه",value:toPersianNumber(t.data.labData.labName)},{label:"تلفن همراه ارتباطی اصلی",value:toPersianNumber(t.data.labData.mobilePhoneNumber)},{label:"تلفن تماس دوم",value:toPersianNumber(t.data.labData.phoneNumber)},{label:"آدرس",value:toPersianNumber(t.data.labData.address)},{label:"کد پستی",value:toPersianNumber(t.data.labData.postalCode)},{label:"آدرس درگاه اینترنتی",value:t.data.labData.websiteAddress},{label:"نام کاربری",value:t.data.labData.username},{label:"تاریخ عضویت",value:persianDate(t.data.labData.subscriptionDate).format("L")}],e.setBackHandler(function(){n.go("panel.home")}),e.setPageTitle("اطلاعات کاربری آزمایشگاه")}]),app.controller("AdminController",["$scope","$rootScope","$state","$stateParams","$timeout","$interval","UserService",function(e,t,n,r,o,a,i){function s(t){o(function(){e.loading=t,e.loadingMessage=!1,t&&o(function(){e.loadingMessage=!0},1500)})}function l(e){d.pageTitle=e}function u(n){return function(){return n||e.setLoading(!0),i.refresh().then(function(r){t.data.adminData=r,n||e.setLoading(!1)})}}e.setLoading=s,e.setPageTitle=l,e.refreshUserData=u(!1),e.loading=e.loadingMessage=!1;var c=a(u(!0),6e4);e.$on("$distroy",function(){a.cancel(c)}),e.setMenuHandlers({goToMainPage:function(){n.go("admin.home")},goToLaboratoryPage:function(){n.go("admin.laboratory")},goToPatientPage:function(){n.go("admin.patient")},goToSmsPage:function(){n.go("admin.sms")},logout:function(){return s(!0),i.logout().then(function(){s(!1),n.go("lab.login")})}});var d={pageTitle:""};e.setHeaderHandlers(d),e.setFooterHandlers(!1)}]),app.controller("AnswerController",["$rootScope","$scope","$timeout","$window","$location","$state","$stateParams","HistoryService",function(e,t,n,r,o,a,i,s){function l(){d||(d=new Clipboard("#ja-shared-url-copy"),d.on("success",function(e){console.info("Success",e.action,e.text),e.clearSelection()}),d.on("error",function(e){console.info("Error",e.action,e.text)}))}function u(e){return function(t){switch(t.event){case"error":e.error=t.error;break;case"render start":delete e.error}e.loaded=["loaded pages","render start","render finish","error"].indexOf(e.model.state)>=0,c()}}function c(e){"function"==typeof e&&p.indexOf(e)<0&&(g&&e(),g||p.push(e)),!g&&t.answer&&(g=t.answer.files.reduce(function(e,t,n){return"pdf"!==t.material?e:e&&t.loaded},!0))&&p.forEach(function(e){e()})}t.nationalCode=i.p,t.postCode=i.n,t.pdfFileEventHandlerMaker=u,t.copySharedUrl=l;var d,f=o.absUrl();f=f.slice(0,f.indexOf("#")+2)+"answer"+f.slice(f.indexOf("?"));var h=i.previousState,m=i.previousStateData;t.setBackHandler(function(){a.is("answer.post")?"history"===h?(e.data.patientInfo=m.patientInfo,e.data.history=m.history,a.go(h,{nationalCode:t.nationalCode})):a.go(h||"home.find"):a.go("answer.post")}),t.setMenuHandlers({viewFile:function(){a.go("answer.post")},saveFile:function(){a.go("answer.download")},shareFile:function(){d=void 0,t.sharedUrl=f,t.sharingViaSms="sms:;?&"+simpleQueryString.stringify({body:"سلام!\nنتایج آزمایش "+t.answer.patientNam+"در لینک زیر:\n\n"+f}),t.sharingViaEmail="mailto:?&"+simpleQueryString.stringify({body:"سلام!\n"+t.answer.patientName+" می خواهد نتایج آزمایش خود را با شما به اشتراک بگذارد:\n\n"+f,subject:"نتایج آزمایش "+t.answer.patientName}),t.sharingViaTelegram="https://telegram.me/share/url?"+simpleQueryString.stringify({text:"سلام!\n"+t.answer.patientName+" می خواهد نتایج آزمایش خود را با شما به اشتراک بگذارد.",url:f}),a.go("answer.share")},printFile:function(){t.printing=!0,Promise.all([new Promise(function(e,t){n(e,1e3)}),new Promise(function(e,n){var r=t.answer.files.filter(function(e){return"pdf"===e.material});r.length?c(function(){Promise.all(r.map(function(e){return Promise.all(e.model.pages.map(function(e){return e.createDataURL(2400)})).then(function(t){e.dataUrls=t})})).then(e,n)}):e()})]).then(function(){r.print()},function(e){console.log("Coulldn't print:",e)}).then(function(){n(function(){t.printing=!1})})},getPrintingStatus:function(){return t.printing},goToLaboratory:function(){a.go("answer.laboratory")},goToLaboratoryWebsite:function(){var e=t.answer&&t.answer.lab&&t.answer.lab.websiteAddress;e&&(0===e.indexOf("http://")&&0===e.indexOf("https://")||(e="http://"+e),window.open(e,"_blank").focus())},labGetter:function(){return t.answer&&t.answer.lab||{}}}),t.setHeaderHandlers({paitentNameGetter:function(){return t.answer?t.answer.patientName:" "}}),t.setFooterHandlers({postDateGetter:function(){return t.answer?persianDate(t.answer.postDate).format("L"):" "},postCodeGetter:function(){return toPersianNumber(t.postCode)}}),a.go("answer.post"),t.loading=!0,s.loadAnswer(t.nationalCode,t.postCode).then(function(e){e.files.forEach(function(e){e.url="/answer/file/download?p="+t.nationalCode+"&n="+t.postCode+"&f="+e.serverName,e.urlWithoutContentType=e.url+"&t=false",e.type.indexOf("image")>=0?e.material="image":"application/pdf"===e.type&&(e.material="pdf")}),t.answer=e,t.loading=!1},function(e){t.loading=!1,alert(e)}).then(function(){t.answer=t.answer||{},t.answer.lab=t.answer.lab||{},t.labDataForDisplay=[{label:"نام آزمایشگاه",value:toPersianNumber(t.answer.lab.name)},{label:"تلفن تماس",value:t.answer.lab?toPersianNumber(t.answer.lab.mobilePhoneNumber+" - "+t.answer.lab.phoneNumber):""},{label:"آدرس",value:toPersianNumber(t.answer.lab.address)},{label:"کد پستی",value:toPersianNumber(t.answer.lab.postalCode)},{label:"آدرس درگاه اینترنتی",value:t.answer.lab.websiteAddress}]});var p=[],g=!1}]),app.controller("HistoryController",["$rootScope","$scope","$state","$stateParams","$timeout",function(e,t,n,r,o){function a(e){n.go("answer",{p:e.nationalCode,n:e.postCode,previousState:"history",previousStateData:{patientInfo:t.patientInfo,history:t.history}})}if(t.postClicked=a,t.nationalCode=r.nationalCode,t.patientInfo=e.data.patientInfo,t.history=e.data.history,!t.patientInfo)return n.go("home.otp");t.setBackHandler(function(){n.go("home.otp")}),t.setMenuHandlers(!1),t.setHeaderHandlers({paitentName:t.patientInfo.fullName}),t.setFooterHandlers(!1),t.$on("$destroy",function(){delete e.data.patientInfo,delete e.data.history})}]),app.controller("HomeController",["$scope","$state",function(e,t){e.setMenuHandlers({goToHomeFind:function(){t.go("home.find")},goToHomeOtp:function(){t.go("home.otp")},goToLabLogin:function(){t.go("lab.login")},goToHomeAbout:function(){t.go("home.about",{previousState:t.current})},goToHomeContact:function(){t.go("home.contact",{previousState:t.current})}}),e.setHeaderHandlers(!1),e.setFooterHandlers(!0)}]),app.controller("LabController",["$scope","$state",function(e,t){e.setMenuHandlers({goToLabLogin:function(){t.go("lab.login")},goToLabRegister:function(){t.go("lab.register")},goToHomeFind:function(){t.go("home.find")},goToLabAbout:function(){t.go("lab.about",{previousState:t.current})},goToLabContact:function(){t.go("lab.contact",{previousState:t.current})}}),e.setHeaderHandlers(!1),e.setFooterHandlers(!0)}]),app.controller("MasterController",["$scope","$rootScope","$q","$window","$timeout",function(e,t,n,r,o){function a(t){e.backHandler=t}function i(t){e.menuHandlers=t}function s(t){e.headerHandlers=t}function l(t){e.footerHandlers=t}function u(){angular.element("#ja-sidebar-menu").sidebar("setting","transition","overlay").sidebar("setting","mobileTransition","overlay").sidebar("toggle")}function c(t,r,o){e.modal={title:t,message:r,ok:o||"تأیید"};var a=n.defer();return angular.element("#ja-informer-modal").modal({onHide:function(){a.resolve()}}).modal("show"),a.promise}function d(t,r,o,a,i,s){e.modal={title:t,message:r,yes:o||"بله",no:a||"خیر",yesColor:i||"green",noColor:s||"blue"};var l=n.defer();return angular.element("#ja-confirm-modal").modal({onApprove:function(){l.resolve()},onDecline:function(){l.reject()}}).modal("show"),l.promise}e.setBackHandler=a,e.setMenuHandlers=i,e.setHeaderHandlers=s,e.setFooterHandlers=l,e.toggleMenu=u,e.showMessage=c,e.showConfirmMessage=d,e.backHandler=void 0,e.menuHandlers=void 0,e.headerHandlers=void 0,e.footerHandlers=void 0,e.iconJs=r.iconJs}]),app.controller("PanelController",["$scope","$rootScope","$state","$stateParams","$timeout","$interval","UserService",function(e,t,n,r,o,a,i){function s(t){o(function(){e.loading=t,e.loadingMessage=!1,t&&o(function(){e.loadingMessage=!0},1500)})}function l(e){d.pageTitle=e}function u(n){return function(){return n||e.setLoading(!0),i.refresh().then(function(r){t.data.labData=r,n||e.setLoading(!1)})}}e.setLoading=s,e.setPageTitle=l,e.refreshUserData=u(!1),e.loading=e.loadingMessage=!1;var c=a(u(!0),6e4);e.$on("$distroy",function(){a.cancel(c)}),e.setMenuHandlers({goToMainPage:function(){n.go("panel.home")},goToSendResults:function(){n.go("panel.send")},goToResultsHistory:function(){n.go("panel.history")},goToChargeAccount:function(){n.go("panel.balance")},goToUserAccount:function(){n.go("panel.account.summary")},logout:function(){return s(!0),i.logout().then(function(){s(!1),n.go("lab.login")})}});var d={pageTitle:""};e.setHeaderHandlers(d),e.setFooterHandlers(!1)}]),app.directive("pdf",["$timeout","$window","DynamicResourceLoader",function(e,t,n){return{restrict:"E",replace:!0,transclude:!0,scope:{src:"@ngSrc",model:"=?ngModel",width:"@",hideRendering:"@",eventHandler:"&"},template:["<div>",'    <div ng-if="loading" ng-transclude></div>','    <div ng-hide="loading" class="pdf-canvas-container"></div>',"</div>"].join(""),link:function(r,o,a){function i(e){d!=l()&&s()}function s(){if(r.model&&Array.isArray(r.model.pages))return h&&e(function(){r.loading=!0}),f.empty(),d=l(),p({event:"render start",desiredWidth:d}),Promise.all(r.model.pages.map(function(e){var t=e.createCanvas(d,2);return e.canvas=t.canvas,f.append(t.canvas),t.promise})).then(function(){function t(){p({event:"render finish"})}h?e(function(){r.loading=!1}).then(t):t()})}function l(){return o[0].offsetWidth||o[0].clientWidth}r.model=r.model||{};var u=!!r.model.pdf,c=r.model.pages&&Array.isArray(r.model.pages);if(!(u&&c||r.src))return void r.eventHandler({event:"error",error:"No URL has been specified."});var d,f=angular.element(o[0].querySelector(".pdf-canvas-container"));f.css("width",r.width||"100%");var h="true"===r.hideRendering,m="init",p=function(e){e.state=m,m=e.event,r.model&&(r.model.state=m);var t=r.eventHandler();"function"==typeof t&&t(e)};r.loading=!0;var g;g=u?Promise.resolve(r.model.pdf):new Promise(function(e,t){n("pdf.min.js",!1,function(){PDFJS?(p({event:"loading pdf"}),PDFJS.getDocument(r.src).then(function(t){r.model&&(r.model.pdf=t),p({event:"loaded pdf",pdf:t}),e(t)},function(e){t("Could not resolve pdf.")})):t("Could not resolve PDFJS.")})}),g=c?g.then(function(e){return r.model.pages}):g.then(function(e){return p({event:"loading pages"}),Promise.all(Array.range(1,e.numPages).map(function(t){return e.getPage(t)})).then(function(e){return e.forEach(function(e){e.createCanvas=function(t,n){n=n||1;var r=e.getViewport(1);r=e.getViewport(n*t/r.width);var o=document.createElement("canvas"),a=o.getContext("2d");o.width=r.width,o.height=r.height,o.style.width=t+"px",o.style.height=t*r.height/r.width+"px";var i={canvasContext:a,viewport:r};return{canvas:o,promise:e.render(i)}},e.createDataURL=function(t,n,r){var o=e.createCanvas(t);return new Promise(function(e,t){o.promise.then(function(){e(o.canvas.toDataURL(n,r))},function(e){t(e)})})}}),r.model&&(r.model.pages=e),p({event:"loaded pages",pages:e}),e},function(e){return Promise.reject("Could not resolve pages.")})}),g.then(function(t){s(),h||e(function(){r.loading=!1})}).catch(function(e){p({event:"error",error:e})}),t.addEventListener("resize",i),r.$on("$destroy",function(){t.removeEventListener("resize",i)})}}}]),app.directive("zoomable",["$timeout",function(e){return{restrict:"A",replace:!1,transclude:!1,scope:{maxZoom:"&",top:"@",bottom:"@",right:"@",left:"@"},link:function(e,t,n){function r(){var e=d3.event,t=o(i),n=a(i),r=o(s),l=a(s),c=e.transform.k,d=e.transform.x,f=e.transform.y,h=(c-1)/2;d=Math.min(0,Math.max(d,t-r*c))+h*r,f=Math.min(0,Math.max(f,n-l*c))+h*l,e.transform.x=d-h*r,e.transform.y=f-h*l;var m="translate("+d+"px,"+f+"px) scale("+c+")";u.style("-webkit-transform",m).style("-moz-transform",m).style("-ms-transform",m).style("-o-transform",m).style("transform",m)}function o(e){return e[0].offsetWidth||e[0].clientWidth}function a(e){return e[0].offsetHeight||e[0].clientHeight}var i=t,s=angular.element(t[0].children[0]),l=d3.select(i[0]),u=d3.select(s[0]);l.style("position","fixed").style("top",(e.top||"0")+"px").style("bottom",(e.bottom||"0")+"px").style("right",(e.right||"0")+"px").style("left",(e.left||"0")+"px"),u.style("min-width",o(i)+"px").style("min-height",a(i)+"px");var c=d3.zoom().scaleExtent([1,function(){try{var t=e.maxZoom();if(!t)throw"No attribute max-zoom limit has been specified.";if("number"!=typeof t)throw"Attribute max-zoom limit is not a number.";if(!(t>0&&t<1e5))throw"Attribute max-zoom limit is out of range.";return t}catch(e){return console.error(e),1}}()]).duration(400).on("zoom",r);l.call(c)}}}]),app.filter("currencySeparator",function(){return function(e,t){e=String(e||""),t=t||",";for(var n="";e.length;)n=e.slice(-3)+n,e=e.slice(0,-3),e.length&&(n=t+n);return n}}),app.filter("emptyCheck",function(){return function(e,t){return void 0===e||null===e||""===e?t||"–":String(e)}}),app.filter("toPersianDate",function(){return function(e,t){return persianDate(new Date(e)).format(t||"L")}}),app.filter("toPersianNumber",function(){return function(e){return toPersianNumber(String(e))}});